var __reflect=this&&this.__reflect||function(e,t,r){e.__class__=t,r?r.push(t):r=[t],e.__types__=e.__types__?r.concat(e.__types__):r},__extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);r.prototype=t.prototype,e.prototype=new r},egret;!function(e){var t;!function(t){var r=new e.TextField,i=function(t){function i(e,i,a,n,o){var s=t.call(this)||this;if(s.arrFps=[],s.arrCost=[],!i&&!a)return s;s.arrFps=[],s.arrCost=[],r.x=void 0==o.x?0:parseInt(o.x),r.y=void 0==o.y?0:parseInt(o.y),r.textColor=void 0==o.textColor?"#ffffff":o.textColor.replace("0x","#");var c=void 0==o.size?12:parseInt(o.size);return r.size=c,s}return __extends(i,t),i.prototype.addFps=function(){},i.prototype.addLog=function(){},i.prototype.update=function(t,i){void 0===i&&(i=!1);var a,n,o;i?(a=this.arrFps[this.arrFps.length-1],n=this.arrCost[this.arrCost.length-1][0],o=this.arrCost[this.arrCost.length-1][1]):(a=t.fps,n=t.costTicker,o=t.costRender,this.lastNumDraw=t.draw,this.arrFps.push(a),this.arrCost.push([n,o]));var s=0,c=this.arrFps.length;c>101&&(c=101,this.arrFps.shift(),this.arrCost.shift());for(var u=this.arrFps[0],h=this.arrFps[0],d=0;c>d;d++){var l=this.arrFps[d];s+=l,u>l?u=l:l>h&&(h=l)}var f=Math.floor(s/c);r.text=a+" FPS \n"+("min:"+u+" max:"+h+" avg:"+f+"\n")+("Draw "+this.lastNumDraw+"\n")+("Cost "+n+" "+o),e.sys.$TempStage.addChild(r)},i.prototype.updateInfo=function(e){},i.prototype.updateWarn=function(e){},i.prototype.updateError=function(e){},i}(e.DisplayObject);t.WebFps=i,__reflect(i.prototype,"egret.wxgame.WebFps",["egret.FPSDisplay"]),e.FPSDisplay=i}(t=e.wxgame||(e.wxgame={}))}(egret||(egret={})),void 0==window.HTMLDivElement&&(window.HTMLDivElement=HTMLElement),void 0==window.HTMLVideoElement&&(window.HTMLVideoElement=HTMLDivElement);var egret;!function(e){var t;!function(t){var r="egret.BitmapData";e.registerClass(HTMLImageElement,r),e.registerClass(HTMLCanvasElement,r),e.registerClass(HTMLVideoElement,r)}(t=e.wxgame||(e.wxgame={}))}(egret||(egret={})),function(e){function t(t){return t.hashCode=t.$hashCode=e.$hashCount++,t}e.$toBitmapData=t}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r;!function(r){function i(e){return window.localStorage.getItem(e)}function a(t,r){try{return window.localStorage.setItem(t,r),!0}catch(i){return e.$warn(1047,t,r),!1}}function n(e){window.localStorage.removeItem(e)}function o(){window.localStorage.clear()}t.getItem=i,t.setItem=a,t.removeItem=n,t.clear=o}(r=t.wxgame||(t.wxgame={}))}(t=e.localStorage||(e.localStorage={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(r){function i(){var e=r.call(this)||this;return e.loaded=!1,e}return __extends(i,r),Object.defineProperty(i.prototype,"length",{get:function(){if(this.originAudio)return this.originAudio.duration;throw new Error("sound not loaded!")},enumerable:!0,configurable:!0}),i.prototype.load=function(t){function r(){n(),c.indexOf("firefox")>=0&&(s.pause(),s.muted=!1),o.loaded=!0,o.dispatchEventWith(e.Event.COMPLETE)}function a(){n(),o.dispatchEventWith(e.IOErrorEvent.IO_ERROR)}function n(){s.removeEventListener("canplaythrough",r),s.removeEventListener("error",a)}var o=this;this.url=t;var s=new Audio(t);s.addEventListener("canplaythrough",r),s.addEventListener("error",a);var c=navigator.userAgent.toLowerCase();c.indexOf("firefox")>=0&&(s.autoplay=!0,s.muted=!0),this.originAudio=s,i.clearAudios[this.url]&&delete i.clearAudios[this.url],i.$recycle(this.url,s)},i.prototype.play=function(r,a){r=+r||0,a=+a||0;var n=i.$pop(this.url);null==n&&(n=this.originAudio.cloneNode()),n.autoplay=!0;var o=new t.HtmlSoundChannel(n);return o.$url=this.url,o.$loops=a,o.$startTime=r,o.$play(),e.sys.$pushSoundChannel(o),o},i.prototype.close=function(){0==this.loaded&&this.originAudio&&(this.originAudio.src=""),this.originAudio&&(this.originAudio=null),i.$clear(this.url)},i.$clear=function(e){i.clearAudios[e]=!0;var t=i.audios[e];t&&(t.length=0)},i.$pop=function(e){var t=i.audios[e];return t&&t.length>0?t.pop():null},i.$recycle=function(e,t){if(!i.clearAudios[e]){var r=i.audios[e];null==i.audios[e]&&(r=i.audios[e]=[]),r.push(t)}},i.MUSIC="music",i.EFFECT="effect",i.audios={},i.clearAudios={},i}(e.EventDispatcher);t.HtmlSound=r,__reflect(r.prototype,"egret.wxgame.HtmlSound",["egret.Sound"])}(t=e.wxgame||(e.wxgame={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(r){function i(t){var i=r.call(this)||this;return i.$startTime=0,i.audio=null,i.isStopped=!1,i.onPlayEnd=function(){return 1==i.$loops?(i.stop(),void i.dispatchEventWith(e.Event.SOUND_COMPLETE)):(i.$loops>0&&i.$loops--,void i.$play())},i._volume=1,t.addEventListener("ended",i.onPlayEnd),i.audio=t,i}return __extends(i,r),i.prototype.$play=function(){return this.isStopped?void e.$error(1036):(this.audio.play(),this.audio.volume=this._volume,void(this.audio.currentTime=this.$startTime))},i.prototype.stop=function(){if(this.audio){this.isStopped||e.sys.$popSoundChannel(this),this.isStopped=!0;var r=this.audio;r.removeEventListener("ended",this.onPlayEnd),r.volume=0,this._volume=0,this.audio=null;var i=this.$url;window.setTimeout(function(){r.pause(),t.HtmlSound.$recycle(i,r)},200)}},Object.defineProperty(i.prototype,"volume",{get:function(){return this._volume},set:function(t){return this.isStopped?void e.$error(1036):(this._volume=t,void(this.audio&&(this.audio.volume=t)))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"position",{get:function(){return this.audio?this.audio.currentTime:0},enumerable:!0,configurable:!0}),i}(e.EventDispatcher);t.HtmlSoundChannel=r,__reflect(r.prototype,"egret.wxgame.HtmlSoundChannel",["egret.SoundChannel","egret.IEventDispatcher"])}(t=e.wxgame||(e.wxgame={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(){function e(){}return e.decodeAudios=function(){if(!(e.decodeArr.length<=0||e.isDecoding)){e.isDecoding=!0;var t=e.decodeArr.shift();e.ctx.decodeAudioData(t.buffer,function(r){t.self.audioBuffer=r,t.success&&t.success(),e.isDecoding=!1,e.decodeAudios()},function(){alert("sound decode error: "+t.url+"！\nsee http://edn.egret.com/cn/docs/page/156"),t.fail&&t.fail(),e.isDecoding=!1,e.decodeAudios()})}},e.decodeArr=[],e.isDecoding=!1,e}();t.WebAudioDecode=r,__reflect(r.prototype,"egret.wxgame.WebAudioDecode");var i=function(i){function a(){var e=i.call(this)||this;return e.loaded=!1,e}return __extends(a,i),Object.defineProperty(a.prototype,"length",{get:function(){if(this.audioBuffer)return this.audioBuffer.duration;throw new Error("sound not loaded!")},enumerable:!0,configurable:!0}),a.prototype.load=function(t){function i(){n.loaded=!0,n.dispatchEventWith(e.Event.COMPLETE)}function a(){n.dispatchEventWith(e.IOErrorEvent.IO_ERROR)}var n=this;this.url=t;var o=new XMLHttpRequest;o.open("GET",t,!0),o.responseType="arraybuffer",o.onreadystatechange=function(){if(4==o.readyState){var t=o.status>=400||0==o.status;t?n.dispatchEventWith(e.IOErrorEvent.IO_ERROR):(r.decodeArr.push({buffer:o.response,success:i,fail:a,self:n,url:n.url}),r.decodeAudios())}},o.send()},a.prototype.play=function(r,i){r=+r||0,i=+i||0;var a=new t.WebAudioSoundChannel;return a.$url=this.url,a.$loops=i,a.$audioBuffer=this.audioBuffer,a.$startTime=r,a.$play(),e.sys.$pushSoundChannel(a),a},a.prototype.close=function(){},a.MUSIC="music",a.EFFECT="effect",a}(e.EventDispatcher);t.WebAudioSound=i,__reflect(i.prototype,"egret.wxgame.WebAudioSound",["egret.Sound"])}(t=e.wxgame||(e.wxgame={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(r){function i(){var i=r.call(this)||this;return i.$startTime=0,i.bufferSource=null,i.context=t.WebAudioDecode.ctx,i.isStopped=!1,i._currentTime=0,i._volume=1,i.onPlayEnd=function(){return 1==i.$loops?(i.stop(),void i.dispatchEventWith(e.Event.SOUND_COMPLETE)):(i.$loops>0&&i.$loops--,void i.$play())},i._startTime=0,i.context.createGain?i.gain=i.context.createGain():i.gain=i.context.createGainNode(),i}return __extends(i,r),i.prototype.$play=function(){if(this.isStopped)return void e.$error(1036);this.bufferSource&&(this.bufferSource.onended=null,this.bufferSource=null);var t=this.context,r=this.gain,i=t.createBufferSource();this.bufferSource=i,i.buffer=this.$audioBuffer,i.connect(r),r.connect(t.destination),i.onended=this.onPlayEnd,this._startTime=Date.now(),this.gain.gain.value=this._volume,i.start(0,this.$startTime),this._currentTime=0},i.prototype.stop=function(){if(this.bufferSource){var t=this.bufferSource;t.stop?t.stop(0):t.noteOff(0),t.onended=null,t.disconnect(),this.bufferSource=null,this.$audioBuffer=null}this.isStopped||e.sys.$popSoundChannel(this),this.isStopped=!0},Object.defineProperty(i.prototype,"volume",{get:function(){return this._volume},set:function(t){return this.isStopped?void e.$error(1036):(this._volume=t,void(this.gain.gain.value=t))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"position",{get:function(){return this.bufferSource?(Date.now()-this._startTime)/1e3+this.$startTime:0},enumerable:!0,configurable:!0}),i}(e.EventDispatcher);t.WebAudioSoundChannel=r,__reflect(r.prototype,"egret.wxgame.WebAudioSoundChannel",["egret.SoundChannel","egret.IEventDispatcher"])}(t=e.wxgame||(e.wxgame={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(r){function i(t,i){void 0===i&&(i=!0);var a=r.call(this)||this;return a.loaded=!1,a.closed=!1,a.heightSet=0/0,a.widthSet=0/0,a.waiting=!1,a.userPause=!1,a.userPlay=!1,a.isPlayed=!1,a.screenChanged=function(t){var r=document.fullscreenEnabled||document.webkitIsFullScreen;r||(a.checkFullScreen(!1),e.Capabilities.isMobile||(a._fullscreen=r))},a._fullscreen=!0,a.onVideoLoaded=function(){a.video.removeEventListener("canplay",a.onVideoLoaded);var t=a.video;a.loaded=!0,a.posterData&&(a.posterData.width=a.getPlayWidth(),a.posterData.height=a.getPlayHeight()),t.width=t.videoWidth,t.height=t.videoHeight,window.setTimeout(function(){a.dispatchEventWith(e.Event.COMPLETE)},200)},a.$renderNode=new e.sys.BitmapNode,a.src=t,a.once(e.Event.ADDED_TO_STAGE,a.loadPoster,a),t&&a.load(),a}return __extends(i,r),i.prototype.load=function(t,r){var i=this;if(void 0===r&&(r=!0),t=t||this.src,this.src=t,!this.video||this.video.src!=t){var a;!this.video||e.Capabilities.isMobile?(a=document.createElement("video"),this.video=a,a.controls=null):a=this.video,a.src=t,a.setAttribute("autoplay","autoplay"),a.setAttribute("webkit-playsinline","true"),a.addEventListener("canplay",this.onVideoLoaded),a.addEventListener("error",function(){return i.onVideoError()}),a.addEventListener("ended",function(){return i.onVideoEnded()});var n=!1;a.addEventListener("canplay",function(){i.waiting=!1,n?i.userPause?i.pause():i.userPlay&&i.play():(n=!0,a.pause())}),a.addEventListener("waiting",function(){i.waiting=!0}),a.load(),this.videoPlay(),a.style.position="absolute",a.style.top="0px",a.style.zIndex="-88888",a.style.left="0px",a.height=1,a.width=1}},i.prototype.play=function(t,r){var i=this;if(void 0===r&&(r=!1),0==this.loaded)return this.load(this.src),void this.once(e.Event.COMPLETE,function(e){return i.play(t,r)},this);this.isPlayed=!0;var a=this.video;void 0!=t&&(a.currentTime=+t||0),a.loop=!!r,e.Capabilities.isMobile?a.style.zIndex="-88888":a.style.zIndex="9999",a.style.position="absolute",a.style.top="0px",a.style.left="0px",a.height=a.videoHeight,a.width=a.videoWidth,"Windows PC"!=e.Capabilities.os&&"Mac OS"!=e.Capabilities.os&&window.setTimeout(function(){a.width=0},1e3),this.checkFullScreen(this._fullscreen)},i.prototype.videoPlay=function(){return this.userPause=!1,this.waiting?void(this.userPlay=!0):(this.userPlay=!1,void this.video.play())},i.prototype.checkFullScreen=function(t){var r=this.video;if(t)null==r.parentElement&&(r.removeAttribute("webkit-playsinline"),document.body.appendChild(r)),e.stopTick(this.markDirty,this),this.goFullscreen();else if(null!=r.parentElement&&r.parentElement.removeChild(r),r.setAttribute("webkit-playsinline","true"),this.setFullScreenMonitor(!1),e.startTick(this.markDirty,this),e.Capabilities.isMobile)return this.video.currentTime=0,void this.onVideoEnded();this.videoPlay()},i.prototype.goFullscreen=function(){var e,r=this.video;return e=t.getPrefixStyleName("requestFullscreen",r),r[e]||(e=t.getPrefixStyleName("requestFullScreen",r),r[e])?(r.removeAttribute("webkit-playsinline"),r[e](),this.setFullScreenMonitor(!0),!0):!0},i.prototype.setFullScreenMonitor=function(e){var t=this.video;e?(t.addEventListener("mozfullscreenchange",this.screenChanged),t.addEventListener("webkitfullscreenchange",this.screenChanged),t.addEventListener("mozfullscreenerror",this.screenError),t.addEventListener("webkitfullscreenerror",this.screenError)):(t.removeEventListener("mozfullscreenchange",this.screenChanged),t.removeEventListener("webkitfullscreenchange",this.screenChanged),t.removeEventListener("mozfullscreenerror",this.screenError),t.removeEventListener("webkitfullscreenerror",this.screenError))},i.prototype.screenError=function(){e.$error(3014)},i.prototype.exitFullscreen=function(){document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.oCancelFullScreen?document.oCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()},i.prototype.onVideoEnded=function(){this.pause(),this.isPlayed=!1,this.dispatchEventWith(e.Event.ENDED)},i.prototype.onVideoError=function(){this.dispatchEventWith(e.IOErrorEvent.IO_ERROR)},i.prototype.close=function(){var e=this;this.closed=!0,this.video.removeEventListener("canplay",this.onVideoLoaded),this.video.removeEventListener("error",function(){return e.onVideoError()}),this.video.removeEventListener("ended",function(){return e.onVideoEnded()}),this.pause(),0==this.loaded&&this.video&&(this.video.src=""),this.video&&this.video.parentElement&&(this.video.parentElement.removeChild(this.video),this.video=null),this.loaded=!1},i.prototype.pause=function(){return this.userPlay=!1,this.waiting?void(this.userPause=!0):(this.userPause=!1,void e.stopTick(this.markDirty,this))},Object.defineProperty(i.prototype,"volume",{get:function(){return this.video?this.video.volume:1},set:function(e){this.video&&(this.video.volume=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"position",{get:function(){return this.video?this.video.currentTime:0},set:function(e){this.video&&(this.video.currentTime=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fullscreen",{get:function(){return this._fullscreen},set:function(t){e.Capabilities.isMobile||(this._fullscreen=!!t,this.video&&0==this.video.paused&&this.checkFullScreen(this._fullscreen))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bitmapData",{get:function(){return this.video&&this.loaded?(this._bitmapData||(this.video.width=this.video.videoWidth,this.video.height=this.video.videoHeight,this._bitmapData=new e.BitmapData(this.video),this._bitmapData.$deleteSource=!1),this._bitmapData):null},enumerable:!0,configurable:!0}),i.prototype.loadPoster=function(){var t=this,r=this.poster;if(r){var i=new e.ImageLoader;i.once(e.Event.COMPLETE,function(e){i.data;t.posterData=i.data,t.posterData.width=t.getPlayWidth(),t.posterData.height=t.getPlayHeight()},this),i.load(r)}},i.prototype.$measureContentBounds=function(e){var t=this.bitmapData,r=this.posterData;t?e.setTo(0,0,this.getPlayWidth(),this.getPlayHeight()):r?e.setTo(0,0,this.getPlayWidth(),this.getPlayHeight()):e.setEmpty()},i.prototype.getPlayWidth=function(){return isNaN(this.widthSet)?this.bitmapData?this.bitmapData.width:this.posterData?this.posterData.width:0/0:this.widthSet},i.prototype.getPlayHeight=function(){return isNaN(this.heightSet)?this.bitmapData?this.bitmapData.height:this.posterData?this.posterData.height:0/0:this.heightSet},i.prototype.$updateRenderNode=function(){var t=this.$renderNode,r=this.bitmapData,i=this.posterData,a=this.getPlayWidth(),n=this.getPlayHeight();this.isPlayed&&!e.Capabilities.isMobile||!i?this.isPlayed&&r&&(t.image=r,t.imageWidth=r.width,t.imageHeight=r.height,e.WebGLUtils.deleteWebGLTexture(r.webGLTexture),r.webGLTexture=null,t.drawImage(0,0,r.width,r.height,0,0,a,n)):(t.image=i,t.imageWidth=a,t.imageHeight=n,t.drawImage(0,0,i.width,i.height,0,0,a,n))},i.prototype.markDirty=function(){return this.$renderDirty=!0,!0},i.prototype.$setHeight=function(e){this.heightSet=+e||0,r.prototype.$setHeight.call(this,e)},i.prototype.$setWidth=function(e){this.widthSet=+e||0,r.prototype.$setWidth.call(this,e)},Object.defineProperty(i.prototype,"paused",{get:function(){return this.video?this.video.paused:!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"length",{get:function(){if(this.video)return this.video.duration;throw new Error("Video not loaded!")},enumerable:!0,configurable:!0}),i}(e.DisplayObject);t.WebVideo=r,__reflect(r.prototype,"egret.wxgame.WebVideo",["egret.Video","egret.DisplayObject"]),e.Video=r}(t=e.wxgame||(e.wxgame={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(t){function r(){var e=t.call(this)||this;return e._url="",e._method="",e}return __extends(r,t),Object.defineProperty(r.prototype,"response",{get:function(){return this._response?this._response:null},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"responseType",{get:function(){return this._responseType},set:function(e){this._responseType=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"withCredentials",{get:function(){return this._withCredentials},set:function(e){this._withCredentials=e},enumerable:!0,configurable:!0}),r.prototype.open=function(e,t){void 0===t&&(t="GET"),this._url=e,this._method=t},r.prototype.readFileAsync=function(){var t=this,r=function(r){t._response=r,t.dispatchEventWith(e.Event.COMPLETE)},i=function(){t.dispatchEventWith(e.IOErrorEvent.IO_ERROR)},a=wx.getFileSystemManager();"arraybuffer"==t.responseType?a.readFile({filePath:t._url,success:function(e){var t=e.data;r(t)},fail:function(){i()}}):a.readFile({filePath:t._url,encoding:"utf8",success:function(e){var t=e.data;r(t)},fail:function(){i()}})},r.prototype.send=function(t){if(this._response=void 0,this.isNetUrl(this._url)){var r=this;wx.request({data:t,url:this._url,method:this._method,header:this.headerObj,responseType:this.responseType,success:function(t){var i=t.data,a=t.statusCode,n=t.header;if(200!=a)return void r.dispatchEventWith(e.IOErrorEvent.IO_ERROR);if("string"!=typeof i&&!(i instanceof ArrayBuffer))try{i=JSON.stringify(i)}catch(o){i=i}r._responseHeader=n,r._response=i,r.dispatchEventWith(e.Event.COMPLETE)},fail:function(t){r.dispatchEventWith(e.IOErrorEvent.IO_ERROR)}})}else this.readFileAsync()},r.prototype.isNetUrl=function(e){return-1!=e.indexOf("http://")||-1!=e.indexOf("HTTP://")||-1!=e.indexOf("https://")||-1!=e.indexOf("HTTPS://")},r.prototype.abort=function(){},r.prototype.getAllResponseHeaders=function(){var e=this._responseHeader;return e?Object.keys(e).map(function(t){return t+": "+e[t]}).join("\n"):null},r.prototype.setRequestHeader=function(e,t){this.headerObj||(this.headerObj={}),this.headerObj[e]=t},r.prototype.getResponseHeader=function(e){if(!this._responseHeader)return null;var t=this._responseHeader[e];return t?t:""},r.prototype.updateProgress=function(t){t.lengthComputable&&e.ProgressEvent.dispatchProgressEvent(this,e.ProgressEvent.PROGRESS,t.loaded,t.total)},r}(e.EventDispatcher);t.WebHttpRequest=r,__reflect(r.prototype,"egret.wxgame.WebHttpRequest",["egret.HttpRequest"]),e.HttpRequest=r}(t=e.wxgame||(e.wxgame={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=(window.URL||window.webkitURL,function(r){function i(){var e=null!==r&&r.apply(this,arguments)||this;return e.data=null,e._crossOrigin=null,e._hasCrossOriginSet=!1,e.currentImage=null,e.request=null,e}return __extends(i,r),Object.defineProperty(i.prototype,"crossOrigin",{get:function(){return this._crossOrigin},set:function(e){this._hasCrossOriginSet=!0,this._crossOrigin=e},enumerable:!0,configurable:!0}),i.prototype.load=function(e){this.loadImage(e)},i.prototype.loadImage=function(e){var t=new Image;this.data=null,this.currentImage=t,this._hasCrossOriginSet?this._crossOrigin&&(t.crossOrigin=this._crossOrigin):i.crossOrigin&&(t.crossOrigin=i.crossOrigin),t.onload=this.onImageComplete.bind(this),t.onerror=this.onLoadError.bind(this),t.src=e},i.prototype.onImageComplete=function(r){var i=this.getImage(r);if(i){this.data=new e.BitmapData(i),t.preUploadTexture&&"webgl"==e.Capabilities.renderMode&&t.WebGLRenderContext.getInstance(null,null).getWebGLTexture(this.data);var a=this;window.setTimeout(function(){a.dispatchEventWith(e.Event.COMPLETE)},0)}},i.prototype.onLoadError=function(e){var t=this.getImage(e);t&&this.dispatchIOError(t.src)},i.prototype.dispatchIOError=function(t){var r=this;window.setTimeout(function(){r.dispatchEventWith(e.IOErrorEvent.IO_ERROR)},0)},i.prototype.getImage=function(e){var t=e.target;t.src;return t.onerror=null,t.onload=null,this.currentImage!==t?null:(this.currentImage=null,t)},i.crossOrigin=null,i}(e.EventDispatcher));t.WebImageLoader=r,__reflect(r.prototype,"egret.wxgame.WebImageLoader",["egret.ImageLoader"]),e.ImageLoader=r}(t=e.wxgame||(e.wxgame={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(t){function r(){var e=t.call(this)||this;return e.textValue="",e.onKeyboardComplete=e.onKeyboardComplete.bind(e),e.onKeyboardInput=e.onKeyboardInput.bind(e),e}return __extends(r,t),r.prototype.$setTextField=function(e){return this.$textfield=e,!0},r.prototype.$addToStage=function(){},r.prototype.$show=function(){var t={defaultValue:this.$textfield.text,multiple:this.$textfield.multiline,confirmHold:!0,confirmType:"done",fail:function(e){console.log(e.errMsg)}};this.$textfield.maxChars&&(t.maxLength=this.$textfield.maxChars),wx.showKeyboard(t),wx.onKeyboardConfirm(this.onKeyboardComplete),wx.onKeyboardComplete(this.onKeyboardComplete),wx.onKeyboardInput(this.onKeyboardInput),this.dispatchEvent(new e.Event("focus"))},r.prototype.onKeyboardInput=function(t){this.textValue=t.value,e.Event.dispatchEvent(this,"updateText",!1)},r.prototype.onKeyboardComplete=function(e){this.$textfield.text=e.value,this.$hide()},r.prototype.$hide=function(){wx.offKeyboardComplete(),wx.offKeyboardConfirm(),wx.offKeyboardInput(),wx.hideKeyboard({}),this.dispatchEvent(new e.Event("blur"))},r.prototype.$getText=function(){return this.textValue||(this.textValue=""),this.textValue},r.prototype.$setText=function(e){return this.textValue=e,!0},r.prototype.$setColor=function(e){return!0},r.prototype.$onBlur=function(){},r.prototype.$removeFromStage=function(){},r.prototype.$resetStageText=function(){},r}(e.EventDispatcher);t.HTML5StageText=r,__reflect(r.prototype,"egret.wxgame.HTML5StageText",["egret.StageText"]),e.StageText=r}(t=e.wxgame||(e.wxgame={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){function r(t,r,n,o,s){a||i();var c="";s&&(c+="italic "),o&&(c+="bold "),c+=(n||12)+"px ",c+=r||"Arial",a.font=c;var u=a.measureText(t);return u?u.width:(e.warn("context.measureText result is null or undefined = "+t),0)}function i(){a=e.sys.canvasHitTestBuffer.context,a.textAlign="left",a.textBaseline="middle"}var a=null;e.sys.measureText=r}(t=e.wxgame||(e.wxgame={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){function r(e,t){var r=document.createElement("canvas");isNaN(e)||isNaN(t)||(r.width=e,r.height=t);var i=r.getContext("2d");if(void 0===i.imageSmoothingEnabled){for(var a,n=["webkitImageSmoothingEnabled","mozImageSmoothingEnabled","msImageSmoothingEnabled"],o=n.length-1;o>=0&&(a=n[o],void 0===i[a]);o--);try{Object.defineProperty(i,"imageSmoothingEnabled",{get:function(){return this[a]},set:function(e){this[a]=e}})}catch(s){i.imageSmoothingEnabled=i[a]}}return r}var i=function(){function i(e,i,a){a?t.isSubContext?this.surface=window.sharedCanvas:this.surface=window.canvas:this.surface=r(e,i),this.context=this.surface.getContext("2d"),this.context&&(this.context.$offsetX=0,this.context.$offsetY=0)}return Object.defineProperty(i.prototype,"width",{get:function(){return this.surface.width},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this.surface.height},enumerable:!0,configurable:!0}),i.prototype.resize=function(r,i,a){var n=this.surface;if(!t.isSubContext){if(a){var o=!1;n.width<r&&(n.width=r,"canvas"===e.Capabilities.renderMode&&(window.sharedCanvas.width=r),o=!0),n.height<i&&(n.height=i,"canvas"===e.Capabilities.renderMode&&(window.sharedCanvas.height=i),o=!0),o||(this.context.globalCompositeOperation="source-over",this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1)}else n.width!=r&&(n.width=r,"canvas"===e.Capabilities.renderMode&&(window.sharedCanvas.width=r)),n.height!=i&&(n.height=i,"canvas"===e.Capabilities.renderMode&&(window.sharedCanvas.height=i));this.clear()}},i.prototype.getPixels=function(e,t,r,i){return void 0===r&&(r=1),void 0===i&&(i=1),this.context.getImageData(e,t,r,i).data},i.prototype.toDataURL=function(e,t){return this.surface.toDataURL(e,t)},i.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.surface.width,this.surface.height)},i.prototype.destroy=function(){this.surface.width=this.surface.height=0},i}();t.CanvasRenderBuffer=i,__reflect(i.prototype,"egret.wxgame.CanvasRenderBuffer",["egret.sys.RenderBuffer"])}(t=e.wxgame||(e.wxgame={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(r){function i(t,i){var a=r.call(this)||this;return a.onTouchBegin=function(e){var t=a.getLocation(e);a.touch.onTouchBegin(t.x,t.y,e.identifier)},a.onTouchMove=function(e){var t=a.getLocation(e);a.touch.onTouchMove(t.x,t.y,e.identifier)},a.onTouchEnd=function(e){var t=a.getLocation(e);a.touch.onTouchEnd(t.x,t.y,e.identifier)},a.scaleX=1,a.scaleY=1,a.rotation=0,a.canvas=i,a.touch=new e.sys.TouchHandler(t),a.addTouchListener(),a}return __extends(i,r),i.prototype.addTouchListener=function(){var e=this;t.isSubContext?(wx.onTouchStart(function(t){for(var r=t.changedTouches.length,i=0;r>i;i++)e.onTouchBegin(t.changedTouches[i])}),wx.onTouchMove(function(t){for(var r=t.changedTouches.length,i=0;r>i;i++)e.onTouchMove(t.changedTouches[i])}),wx.onTouchEnd(function(t){for(var r=t.changedTouches.length,i=0;r>i;i++)e.onTouchEnd(t.changedTouches[i])}),wx.onTouchCancel(function(t){for(var r=t.changedTouches.length,i=0;r>i;i++)e.onTouchEnd(t.changedTouches[i])})):(e.canvas.addEventListener("touchstart",function(t){for(var r=t.changedTouches.length,i=0;r>i;i++)e.onTouchBegin(t.changedTouches[i]);e.prevent(t)},!1),e.canvas.addEventListener("touchmove",function(t){for(var r=t.changedTouches.length,i=0;r>i;i++)e.onTouchMove(t.changedTouches[i]);e.prevent(t)},!1),e.canvas.addEventListener("touchend",function(t){for(var r=t.changedTouches.length,i=0;r>i;i++)e.onTouchEnd(t.changedTouches[i]);e.prevent(t)},!1),e.canvas.addEventListener("touchcancel",function(t){for(var r=t.changedTouches.length,i=0;r>i;i++)e.onTouchEnd(t.changedTouches[i]);e.prevent(t)},!1))},i.prototype.prevent=function(e){e.stopPropagation(),1==e.isScroll||this.canvas.userTyping||e.preventDefault()},i.prototype.getLocation=function(t){var r=(document.documentElement,this.canvas.getBoundingClientRect()),i=r.left,a=r.top,n=t.pageX-i,o=n,s=t.pageY-a,c=s;return 90==this.rotation?(o=s,c=r.width-n):-90==this.rotation&&(o=r.height-s,c=n),o/=this.scaleX,c/=this.scaleY,e.$TempPoint.setTo(Math.round(o),Math.round(c))},i.prototype.updateScaleMode=function(e,t,r){this.scaleX=e,this.scaleY=t,this.rotation=r},i.prototype.$updateMaxTouches=function(){this.touch.$initMaxTouches()},i}(e.HashObject);t.WebTouchHandler=r,__reflect(r.prototype,"egret.wxgame.WebTouchHandler")}(t=e.wxgame||(e.wxgame={}))}(egret||(egret={}));var egret;!function(e){var t;!function(e){var t=!0;e.WebLifeCycleHandler=function(e){wx.onShow&&wx.onShow(function(){t||(e.resume(),t=!0)}),wx.onHide&&wx.onHide(function(){t&&(e.pause(),t=!1)})}}(t=e.wxgame||(e.wxgame={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){function r(e,t){var r="";if(null!=t)r=i(e,t);else{if(null==o){var a=document.createElement("div").style;o=i("transform",a)}r=o}return""==r?e:r+e.charAt(0).toUpperCase()+e.substring(1,e.length)}function i(e,t){if(e in t)return"";e=e.charAt(0).toUpperCase()+e.substring(1,e.length);for(var r=["webkit","ms","Moz","O"],i=0;i<r.length;i++){var a=r[i]+e;if(a in t)return r[i]}return""}var a=function(){function e(){}return e.WEB_AUDIO=2,e.HTML5_AUDIO=3,e}();t.AudioType=a,__reflect(a.prototype,"egret.wxgame.AudioType");var n=function(r){function i(){return r.call(this)||this}return __extends(i,r),i.$init=function(){var r=navigator.userAgent.toLowerCase();i.ua=r,i._canUseBlob=!1;var n=window.AudioContext||window.webkitAudioContext||window.mozAudioContext;if(n)try{t.WebAudioDecode.ctx=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext)}catch(o){n=!1}var s,c=i._audioType;c==a.WEB_AUDIO&&n||c==a.HTML5_AUDIO?(s=!1,i.setAudioType(c)):(s=!0,i.setAudioType(a.HTML5_AUDIO)),r.indexOf("android")>=0?s&&n&&i.setAudioType(a.WEB_AUDIO):(r.indexOf("iphone")>=0||r.indexOf("ipad")>=0||r.indexOf("ipod")>=0)&&i.getIOSVersion()>=7&&(i._canUseBlob=!0,s&&n&&i.setAudioType(a.WEB_AUDIO));var u=window.URL||window.webkitURL;u||(i._canUseBlob=!1),r.indexOf("egretnative")>=0&&(i.setAudioType(a.HTML5_AUDIO),i._canUseBlob=!0),e.Sound=i._AudioClass},i.setAudioType=function(e){switch(i._audioType=e,e){case a.WEB_AUDIO:i._AudioClass=t.WebAudioSound;break;case a.HTML5_AUDIO:i._AudioClass=t.HtmlSound}},i.getIOSVersion=function(){var e=i.ua.toLowerCase().match(/cpu [^\d]*\d.*like mac os x/)[0];return parseInt(e.match(/\d+(_\d)*/)[0])||0},i._canUseBlob=!1,i._audioType=0,i.ua="",i}(e.HashObject);t.Html5Capatibility=n,__reflect(n.prototype,"egret.wxgame.Html5Capatibility");var o=null;t.getPrefixStyleName=r,t.getPrefix=i}(t=e.wxgame||(e.wxgame={}))}(egret||(egret={}));var egret;!function(e){var t;!function(e){e.version="1.0.7",e.isSubContext=!1,e.preUploadTexture=!1}(t=e.wxgame||(e.wxgame={}))}(egret||(egret={})),function(e){var t;!function(t){function r(){s&&window.player.updateScreenSize()}function i(r){if(!s){if(s=!0,r||(r={}),t.Html5Capatibility._audioType=r.audioType,t.Html5Capatibility.$init(),"webgl"==r.renderMode){var i=r.antialias;t.WebGLRenderContext.antialias=!!i}e.sys.CanvasRenderBuffer=t.CanvasRenderBuffer,a(r.renderMode);var u;if(r.canvasScaleFactor)u=r.canvasScaleFactor;else if(r.calculateCanvasScaleFactor)u=r.calculateCanvasScaleFactor(e.sys.canvasHitTestBuffer.context);else{var h=e.sys.canvasHitTestBuffer.context,d=h.backingStorePixelRatio||h.webkitBackingStorePixelRatio||h.mozBackingStorePixelRatio||h.msBackingStorePixelRatio||h.oBackingStorePixelRatio||h.backingStorePixelRatio||1;u=(window.devicePixelRatio||1)/d}e.sys.DisplayList.$canvasScaleFactor=u;var l=e.ticker;n(l),r.screenAdapter?e.sys.screenAdapter=r.screenAdapter:e.sys.screenAdapter||(e.sys.screenAdapter=new e.sys.DefaultScreenAdapter);var f={},p=new t.WebPlayer(f,r);window.player=p,window.addEventListener("resize",function(){isNaN(c)&&(c=window.setTimeout(o,300))})}}function a(r){"webgl"===r?(e.Capabilities.renderMode="webgl",e.sys.RenderBuffer=t.WebGLRenderBuffer,e.sys.systemRenderer=new t.WebGLRenderer,e.sys.canvasRenderer=new e.CanvasRenderer,e.sys.customHitTestBuffer=new t.WebGLRenderBuffer(3,3),e.sys.canvasHitTestBuffer=new t.CanvasRenderBuffer(3,3)):(e.Capabilities.renderMode="canvas",e.sys.RenderBuffer=t.CanvasRenderBuffer,e.sys.systemRenderer=new e.CanvasRenderer,e.sys.canvasRenderer=e.sys.systemRenderer,e.sys.customHitTestBuffer=new t.CanvasRenderBuffer(3,3),e.sys.canvasHitTestBuffer=e.sys.customHitTestBuffer)}function n(e){function t(){e.update(),r(t)}var r=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;
r||(r=function(e){return window.setTimeout(e,1e3/60)}),r(t)}function o(){c=0/0,e.updateAllScreens()}var s=!1;e.runEgret=i,e.updateAllScreens=r;var c=0/0}(t=e.wxgame||(e.wxgame={}))}(egret||(egret={}));var language;egret.Capabilities.runtimeType=egret.RuntimeType.WXGAME;var egret;!function(e){var t;!function(t){var r=function(){function t(){}return t.detect=function(){var r=e.Capabilities,i=navigator.userAgent.toLowerCase();r.isMobile=-1!=i.indexOf("mobile")||-1!=i.indexOf("android"),r.isMobile?i.indexOf("windows")<0&&(-1!=i.indexOf("iphone")||-1!=i.indexOf("ipad")||-1!=i.indexOf("ipod"))?r.os="iOS":-1!=i.indexOf("android")&&-1!=i.indexOf("linux")?r.os="Android":-1!=i.indexOf("windows")&&(r.os="Windows Phone"):-1!=i.indexOf("windows nt")?r.os="Windows PC":-1!=i.indexOf("mac os")&&(r.os="Mac OS");var a=(navigator.language||navigator.browserLanguage).toLowerCase(),n=a.split("-");n.length>1&&(n[1]=n[1].toUpperCase()),r.language=n.join("-"),t.injectUIntFixOnIE9()},t.injectUIntFixOnIE9=function(){if(/msie 9.0/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)){var e="<!-- IEBinaryToArray_ByteStr -->\r\n<script type='text/vbscript' language='VBScript'>\r\nFunction IEBinaryToArray_ByteStr(Binary)\r\n   IEBinaryToArray_ByteStr = CStr(Binary)\r\nEnd Function\r\nFunction IEBinaryToArray_ByteStr_Last(Binary)\r\n   Dim lastIndex\r\n   lastIndex = LenB(Binary)\r\n   if lastIndex mod 2 Then\r\n       IEBinaryToArray_ByteStr_Last = Chr( AscB( MidB( Binary, lastIndex, 1 ) ) )\r\n   Else\r\n       IEBinaryToArray_ByteStr_Last = \"\"\r\n   End If\r\nEnd Function\r\n</script>\r\n<!-- convertResponseBodyToText -->\r\n<script>\r\nlet convertResponseBodyToText = function (binary) {\r\n   let byteMapping = {};\r\n   for ( let i = 0; i < 256; i++ ) {\r\n       for ( let j = 0; j < 256; j++ ) {\r\n           byteMapping[ String.fromCharCode( i + j * 256 ) ] =\r\n           String.fromCharCode(i) + String.fromCharCode(j);\r\n       }\r\n   }\r\n   let rawBytes = IEBinaryToArray_ByteStr(binary);\r\n   let lastChr = IEBinaryToArray_ByteStr_Last(binary);\r\n   return rawBytes.replace(/[\\s\\S]/g,                           function( match ) { return byteMapping[match]; }) + lastChr;\r\n};\r\n</script>\r\n";document.write(e)}},t}();t.WebCapability=r,__reflect(r.prototype,"egret.wxgame.WebCapability"),r.detect()}(t=e.wxgame||(e.wxgame={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(){function e(){}return e.call=function(e,t){},e.addCallback=function(e,t){},e}();t.WebExternalInterface=r,__reflect(r.prototype,"egret.wxgame.WebExternalInterface",["egret.ExternalInterface"]);var i=navigator.userAgent.toLowerCase();i.indexOf("egretnative")<0&&(e.ExternalInterface=r)}(t=e.wxgame||(e.wxgame={}))}(egret||(egret={})),function(e){var t;!function(t){function r(t){var r=JSON.parse(t),a=r.functionName,n=i[a];if(n){var o=r.value;n.call(null,o)}else e.$warn(1050,a)}var i={},a=function(){function e(){}return e.call=function(e,t){var r={};r.functionName=e,r.value=t,egret_native.sendInfoToPlugin(JSON.stringify(r))},e.addCallback=function(e,t){i[e]=t},e}();t.NativeExternalInterface=a,__reflect(a.prototype,"egret.wxgame.NativeExternalInterface",["egret.ExternalInterface"]);var n=navigator.userAgent.toLowerCase();n.indexOf("egretnative")>=0&&(e.ExternalInterface=a,egret_native.receivedPluginInfo=r)}(t=e.wxgame||(e.wxgame={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){function r(e){var t=wx.getLaunchOptionsSync();return t.query[e]||t[e]}t.getOption=r,e.getOption=r}(t=e.wxgame||(e.wxgame={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(r){function i(e,t){var i=r.call(this)||this;return i.init(e,t),i.initOrientation(),i}return __extends(i,r),i.prototype.init=function(r,i){var a=this.readOption(r,i),n=new e.Stage;n.$screen=this,n.$scaleMode=a.scaleMode,n.$orientation=a.orientation,n.$maxTouches=a.maxTouches,n.frameRate=a.frameRate,n.textureScaleFactor=a.textureScaleFactor;var o=new e.sys.RenderBuffer(void 0,void 0,!0),s=o.surface;this.attachCanvas(r,s);var c=new t.WebTouchHandler(n,s),u=new e.sys.Player(o,n,a.entryClassName);e.lifecycle.stage=n,e.lifecycle.addLifecycleListener(t.WebLifeCycleHandler),(a.showFPS||a.showLog)&&u.displayFPS(a.showFPS,a.showLog,a.logFilter,a.fpsStyles),this.playerOption=a,this.container=r,this.canvas=s,this.stage=n,this.player=u,this.webTouchHandler=c,this.updateScreenSize(),this.updateMaxTouches(),u.start()},i.prototype.initOrientation=function(){var t=this;window.addEventListener("orientationchange",function(){window.setTimeout(function(){e.StageOrientationEvent.dispatchStageOrientationEvent(t.stage,e.StageOrientationEvent.ORIENTATION_CHANGE)},350)})},i.prototype.readOption=function(t,r){var i={};if(i.entryClassName=r.entryClassName||"Main",i.scaleMode=r.scaleMode||e.StageScaleMode.FIXED_WIDTH,i.scaleMode==e.StageScaleMode.SHOW_ALL)throw new Error("小游戏不支持 showAll 适配模式，推荐使用 fixedWidth 模式");i.frameRate=r.frameRate||30,i.contentWidth=r.contentWidth||640,i.contentHeight=r.contentHeight||1136,i.orientation=r.orientation||e.OrientationMode.AUTO,i.maxTouches=r.maxTouches,i.textureScaleFactor=1,i.showFPS=r.showFPS;for(var a=r.fpsStyles||"x:0,y:0,size:12,textColor:0xffffff,bgAlpha:0.9",n=a.split(","),o={},s=0;s<n.length;s++){var c=n[s].split(":");o[c[0]]=c[1]}return i.fpsStyles=o,i.showLog=!1,i.logFilter="",i},i.prototype.attachCanvas=function(e,t){var r=t.style;r.cursor="inherit",r.position="absolute",r.top="0",r.bottom="0",r.left="0",r.right="0"},i.prototype.updateScreenSize=function(){var r=this.canvas;if(!r.userTyping){var i=this.playerOption,a=r.getBoundingClientRect(),n=0,o=a.width,s=a.height;a.top<0&&(s+=a.top,n=-a.top);var c=!1,u=this.stage.$orientation;u!=e.OrientationMode.AUTO&&(c=u!=e.OrientationMode.PORTRAIT&&s>o||u==e.OrientationMode.PORTRAIT&&o>s);var h=c?s:o,d=c?o:s;e.Capabilities.boundingClientWidth=h,e.Capabilities.boundingClientHeight=d;var l=e.sys.screenAdapter.calculateStageSize(this.stage.$scaleMode,h,d,i.contentWidth,i.contentHeight),f=l.stageWidth,p=l.stageHeight,g=l.displayWidth,v=l.displayHeight;r.style[t.getPrefixStyleName("transformOrigin")]="0% 0% 0px",r.width!=f&&(t.isSubContext||(window.sharedCanvas&&(window.sharedCanvas.width=f),r.width=f)),r.height!=p&&(t.isSubContext||(window.sharedCanvas&&(window.sharedCanvas.height=p),r.height=p));var x=0;c?u==e.OrientationMode.LANDSCAPE?(x=90,r.style.top=n+(s-g)/2+"px",r.style.left=(o+v)/2+"px"):(x=-90,r.style.top=n+(s+g)/2+"px",r.style.left=(o-v)/2+"px"):(r.style.top=n+(s-v)/2+"px",r.style.left=(o-g)/2+"px");var m=g/f,y=v/p,w=m*e.sys.DisplayList.$canvasScaleFactor,b=y*e.sys.DisplayList.$canvasScaleFactor,T=new e.Matrix;T.scale(m/w,y/b),T.rotate(x*Math.PI/180);var E="matrix("+T.a+","+T.b+","+T.c+","+T.d+","+T.tx+","+T.ty+")";r.style[t.getPrefixStyleName("transform")]=E,e.sys.DisplayList.$setCanvasScale(w,b),this.webTouchHandler.updateScaleMode(m,y,x),this.player.updateStageSize(f,p)}},i.prototype.setContentSize=function(e,t){var r=this.playerOption;r.contentWidth=e,r.contentHeight=t,this.updateScreenSize()},i.prototype.updateMaxTouches=function(){this.webTouchHandler.$updateMaxTouches()},i}(e.HashObject);t.WebPlayer=r,__reflect(r.prototype,"egret.wxgame.WebPlayer",["egret.sys.Screen"])}(t=e.wxgame||(e.wxgame={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){function r(t,r){s||(s=document.createElement("canvas"),c=s.getContext("2d"));var i=t.$getTextureWidth(),a=t.$getTextureHeight();null==r&&(r=e.$TempRectangle,r.x=0,r.y=0,r.width=i,r.height=a),r.x=Math.min(r.x,i-1),r.y=Math.min(r.y,a-1),r.width=Math.min(r.width,i-r.x),r.height=Math.min(r.height,a-r.y);var n=Math.floor(r.width),o=Math.floor(r.height),u=s;if(u.style.width=n+"px",u.style.height=o+"px",s.width=n,s.height=o,"webgl"==e.Capabilities.renderMode){var h=void 0;t.$renderBuffer?h=t:(h=new e.RenderTexture,h.drawToTexture(new e.Bitmap(t)));for(var d=h.$renderBuffer.getPixels(r.x,r.y,n,o),l=0,f=0,p=0;p<d.length;p+=4)c.fillStyle="rgba("+d[p]+","+d[p+1]+","+d[p+2]+","+d[p+3]/255+")",c.fillRect(l,f,1,1),l++,l==n&&(l=0,f++);return t.$renderBuffer||h.dispose(),u}var g=t,v=Math.round(g.$offsetX),x=Math.round(g.$offsetY),m=g.$bitmapWidth,y=g.$bitmapHeight;return c.drawImage(g.$bitmapData.source,g.$bitmapX+r.x/e.$TextureScaleFactor,g.$bitmapY+r.y/e.$TextureScaleFactor,m*r.width/i,y*r.height/a,v,x,r.width,r.height),u}function i(t,i,a){try{var n=r(this,i),o=n.toDataURL(t,a);return o}catch(s){e.$error(1033)}return null}function a(e,t,i,a){var n=r(this,i),o=n.toTempFilePathSync({fileType:e.indexOf("png")>=0?"png":"jpg"});return wx.getFileSystemManager().saveFile({tempFilePath:o,filePath:wx.env.USER_DATA_PATH+"/"+t,success:function(e){}}),o}function n(t,r){return e.$warn(1041,"getPixel32","getPixels"),this.getPixels(t,r)}function o(t,i,a,n){if(void 0===a&&(a=1),void 0===n&&(n=1),"webgl"==e.Capabilities.renderMode){var o=void 0;this.$renderBuffer?o=this:(o=new e.RenderTexture,o.drawToTexture(new e.Bitmap(this)));var s=o.$renderBuffer.getPixels(t,i,a,n);return s}try{var u=(r(this),c.getImageData(t,i,a,n).data);return u}catch(h){e.$error(1039)}}var s,c;e.Texture.prototype.toDataURL=i,e.Texture.prototype.saveToFile=a,e.Texture.prototype.getPixel32=n,e.Texture.prototype.getPixels=o}(t=e.wxgame||(e.wxgame={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){function r(e){s||(window.DOMParser?s=new DOMParser:console.error("没有 XML 支持库，请访问 http://developer.egret.com/cn/github/egret-docs/Engine2D/minigame/minigameFAQ/index.html#xml 了解详情"));for(var t=s.parseFromString(e,"text/xml"),r=t.childNodes.length,a=0;r>a;a++){var n=t.childNodes[a];if(1==n.nodeType)return i(n,null)}return null}function i(e,t){if("parsererror"==e.localName)throw new Error(e.textContent);for(var r=new n(e.localName,t,e.prefix,e.namespaceURI,e.nodeName),a=e.attributes,s=r.attributes,c=a.length,u=0;c>u;u++){var h=a[u],d=h.name;0!=d.indexOf("xmlns:")&&(s[d]=h.value,r["$"+d]=h.value)}var l=e.childNodes;c=l.length;for(var f=r.children,u=0;c>u;u++){var p=l[u],g=p.nodeType,v=null;if(1==g)v=i(p,r);else if(3==g){var x=p.textContent.trim();x&&(v=new o(x,r))}v&&f.push(v)}return r}var a=function(){function e(e,t){this.nodeType=e,this.parent=t}return e}();t.XMLNode=a,__reflect(a.prototype,"egret.wxgame.XMLNode");var n=function(e){function t(t,r,i,a,n){var o=e.call(this,1,r)||this;return o.attributes={},o.children=[],o.localName=t,o.prefix=i,o.namespace=a,o.name=n,o}return __extends(t,e),t}(a);t.XML=n,__reflect(n.prototype,"egret.wxgame.XML");var o=function(e){function t(t,r){var i=e.call(this,3,r)||this;return i.text=t,i}return __extends(t,e),t}(a);t.XMLText=o,__reflect(o.prototype,"egret.wxgame.XMLText");var s;e.XML={parse:r}}(t=e.wxgame||(e.wxgame={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(t){function r(){var r=null!==t&&t.apply(this,arguments)||this;return r.onChange=function(t){var i=new e.OrientationEvent(e.Event.CHANGE);i.beta=t.beta,i.gamma=t.gamma,i.alpha=t.alpha,r.dispatchEvent(i)},r}return __extends(r,t),r.prototype.start=function(){window.addEventListener("deviceorientation",this.onChange)},r.prototype.stop=function(){window.removeEventListener("deviceorientation",this.onChange)},r}(e.EventDispatcher);t.WebDeviceOrientation=r,__reflect(r.prototype,"egret.wxgame.WebDeviceOrientation",["egret.DeviceOrientation"])}(t=e.wxgame||(e.wxgame={}))}(egret||(egret={})),egret.DeviceOrientation=egret.wxgame.WebDeviceOrientation;var egret;!function(e){var t;!function(t){var r=function(t){function r(r){var i=t.call(this)||this;return i.onUpdate=function(t){var r=new e.GeolocationEvent(e.Event.CHANGE),a=t.coords;r.altitude=a.altitude,r.heading=a.heading,r.accuracy=a.accuracy,r.latitude=a.latitude,r.longitude=a.longitude,r.speed=a.speed,r.altitudeAccuracy=a.altitudeAccuracy,i.dispatchEvent(r)},i.onError=function(t){var r=e.GeolocationEvent.UNAVAILABLE;t.code==t.PERMISSION_DENIED&&(r=e.GeolocationEvent.PERMISSION_DENIED);var a=new e.GeolocationEvent(e.IOErrorEvent.IO_ERROR);a.errorType=r,a.errorMessage=t.message,i.dispatchEvent(a)},i.geolocation=navigator.geolocation,i}return __extends(r,t),r.prototype.start=function(){var t=this.geolocation;t?this.watchId=t.watchPosition(this.onUpdate,this.onError):this.onError({code:2,message:e.sys.tr(3004),PERMISSION_DENIED:1,POSITION_UNAVAILABLE:2})},r.prototype.stop=function(){var e=this.geolocation;e.clearWatch(this.watchId)},r}(e.EventDispatcher);t.WebGeolocation=r,__reflect(r.prototype,"egret.wxgame.WebGeolocation",["egret.Geolocation"]),e.Geolocation=e.wxgame.WebGeolocation}(t=e.wxgame||(e.wxgame={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(t){function r(){var r=null!==t&&t.apply(this,arguments)||this;return r.onChange=function(t){var i=new e.MotionEvent(e.Event.CHANGE),a={x:t.acceleration.x,y:t.acceleration.y,z:t.acceleration.z},n={x:t.accelerationIncludingGravity.x,y:t.accelerationIncludingGravity.y,z:t.accelerationIncludingGravity.z},o={alpha:t.rotationRate.alpha,beta:t.rotationRate.beta,gamma:t.rotationRate.gamma};i.acceleration=a,i.accelerationIncludingGravity=n,i.rotationRate=o,r.dispatchEvent(i)},r}return __extends(r,t),r.prototype.start=function(){window.addEventListener("devicemotion",this.onChange)},r.prototype.stop=function(){window.removeEventListener("devicemotion",this.onChange)},r}(e.EventDispatcher);t.WebMotion=r,__reflect(r.prototype,"egret.wxgame.WebMotion",["egret.Motion"]),e.Motion=e.wxgame.WebMotion}(t=e.wxgame||(e.wxgame={}))}(egret||(egret={}));var egret;!function(e){var t;!function(e){}(t=e.wxgame||(e.wxgame={}))}(egret||(egret={}));var egret;!function(e){var t;!function(e){var t=function(){function e(){this.drawData=[],this.drawDataLen=0}return e.prototype.pushDrawRect=function(){if(0==this.drawDataLen||11!=this.drawData[this.drawDataLen-1].type){var e=this.drawData[this.drawDataLen]||{};e.type=11,e.count=0,this.drawData[this.drawDataLen]=e,this.drawDataLen++}this.drawData[this.drawDataLen-1].count+=2},e.prototype.pushDrawTexture=function(e,t,r,i,a){if(void 0===t&&(t=2),r){var n=this.drawData[this.drawDataLen]||{};n.type=0,n.texture=e,n.filter=r,n.count=t,n.textureWidth=i,n.textureHeight=a,this.drawData[this.drawDataLen]=n,this.drawDataLen++}else{if(0==this.drawDataLen||0!=this.drawData[this.drawDataLen-1].type||e!=this.drawData[this.drawDataLen-1].texture||this.drawData[this.drawDataLen-1].filter){var n=this.drawData[this.drawDataLen]||{};n.type=0,n.texture=e,n.count=0,this.drawData[this.drawDataLen]=n,this.drawDataLen++}this.drawData[this.drawDataLen-1].count+=t}},e.prototype.pushChangeSmoothing=function(e,t){e.smoothing=t;var r=this.drawData[this.drawDataLen]||{};r.type=9,r.texture=e,r.smoothing=t,this.drawData[this.drawDataLen]=r,this.drawDataLen++},e.prototype.pushPushMask=function(e){void 0===e&&(e=1);var t=this.drawData[this.drawDataLen]||{};t.type=1,t.count=2*e,this.drawData[this.drawDataLen]=t,this.drawDataLen++},e.prototype.pushPopMask=function(e){void 0===e&&(e=1);var t=this.drawData[this.drawDataLen]||{};t.type=2,t.count=2*e,this.drawData[this.drawDataLen]=t,this.drawDataLen++},e.prototype.pushSetBlend=function(e){for(var t=this.drawDataLen,r=!1,i=t-1;i>=0;i--){var a=this.drawData[i];if(a){if((0==a.type||11==a.type)&&(r=!0),!r&&3==a.type){this.drawData.splice(i,1),this.drawDataLen--;continue}if(3==a.type){if(a.value==e)return;break}}}var n=this.drawData[this.drawDataLen]||{};n.type=3,n.value=e,this.drawData[this.drawDataLen]=n,this.drawDataLen++},e.prototype.pushResize=function(e,t,r){var i=this.drawData[this.drawDataLen]||{};i.type=4,i.buffer=e,i.width=t,i.height=r,this.drawData[this.drawDataLen]=i,this.drawDataLen++},e.prototype.pushClearColor=function(){var e=this.drawData[this.drawDataLen]||{};e.type=5,this.drawData[this.drawDataLen]=e,this.drawDataLen++},e.prototype.pushActivateBuffer=function(e){for(var t=this.drawDataLen,r=!1,i=t-1;i>=0;i--){var a=this.drawData[i];!a||(3!=a.type&&6!=a.type&&(r=!0),r||6!=a.type)||(this.drawData.splice(i,1),this.drawDataLen--)}var n=this.drawData[this.drawDataLen]||{};n.type=6,n.buffer=e,n.width=e.rootRenderTarget.width,n.height=e.rootRenderTarget.height,this.drawData[this.drawDataLen]=n,this.drawDataLen++},e.prototype.pushEnableScissor=function(e,t,r,i){var a=this.drawData[this.drawDataLen]||{};a.type=7,a.x=e,a.y=t,a.width=r,a.height=i,this.drawData[this.drawDataLen]=a,this.drawDataLen++},e.prototype.pushDisableScissor=function(){var e=this.drawData[this.drawDataLen]||{};e.type=8,this.drawData[this.drawDataLen]=e,this.drawDataLen++},e.prototype.clear=function(){for(var e=0;e<this.drawDataLen;e++){var t=this.drawData[e];t.type=0,t.count=0,t.texture=null,t.filter=null,t.uv=null,t.value="",t.buffer=null,t.width=0,t.height=0}this.drawDataLen=0},e}();e.WebGLDrawCmdManager=t,__reflect(t.prototype,"egret.wxgame.WebGLDrawCmdManager")}(t=e.wxgame||(e.wxgame={}))}(egret||(egret={}));var egret;!function(e){var t;!function(e){var t=function(){function e(){this.size=2e3,this.vertexMaxSize=4*this.size,this.indicesMaxSize=6*this.size,this.vertSize=5,this.vertices=null,this.indices=null,this.indicesForMesh=null,this.vertexIndex=0,this.indexIndex=0,this.hasMesh=!1;var e=this.vertexMaxSize*this.vertSize,t=this.indicesMaxSize;this.vertices=new Float32Array(e),this.indices=new Uint16Array(t),this.indicesForMesh=new Uint16Array(t);for(var r=0,i=0;t>r;r+=6,i+=4)this.indices[r+0]=i+0,this.indices[r+1]=i+1,this.indices[r+2]=i+2,this.indices[r+3]=i+0,this.indices[r+4]=i+2,this.indices[r+5]=i+3}return e.prototype.reachMaxSize=function(e,t){return void 0===e&&(e=4),void 0===t&&(t=6),this.vertexIndex>this.vertexMaxSize-e||this.indexIndex>this.indicesMaxSize-t},e.prototype.getVertices=function(){var e=this.vertices.subarray(0,this.vertexIndex*this.vertSize);return e},e.prototype.getIndices=function(){return this.indices},e.prototype.getMeshIndices=function(){return this.indicesForMesh},e.prototype.changeToMeshIndices=function(){if(!this.hasMesh){for(var e=0,t=this.indexIndex;t>e;++e)this.indicesForMesh[e]=this.indices[e];this.hasMesh=!0}},e.prototype.isMesh=function(){return this.hasMesh},e.prototype.cacheArrays=function(e,t,r,i,a,n,o,s,c,u,h,d,l,f,p){var g=e.globalAlpha,v=e.globalMatrix,x=v.a,m=v.b,y=v.c,w=v.d,b=v.tx,T=v.ty,E=e.$offsetX,C=e.$offsetY;if((0!=E||0!=C)&&(b=E*x+C*y+b,T=E*m+C*w+T),!l){(0!=n||0!=o)&&(b=n*x+o*y+b,T=n*m+o*w+T);var S=s/i;1!=S&&(x=S*x,m=S*m);var _=c/a;1!=_&&(y=_*y,w=_*w)}if(l){var L=this.vertices,R=this.vertexIndex*this.vertSize,A=0,O=0,D=0,M=0,B=0,$=0,I=0;for(A=0,D=d.length;D>A;A+=2)O=R+5*A/2,$=l[A],I=l[A+1],M=d[A],B=d[A+1],L[O+0]=x*$+y*I+b,L[O+1]=m*$+w*I+T,p?(L[O+2]=(t+(1-B)*a)/u,L[O+3]=(r+M*i)/h):(L[O+2]=(t+M*i)/u,L[O+3]=(r+B*a)/h),L[O+4]=g;if(this.hasMesh)for(var F=0,P=f.length;P>F;++F)this.indicesForMesh[this.indexIndex+F]=f[F]+this.vertexIndex;this.vertexIndex+=d.length/2,this.indexIndex+=f.length}else{var G=u,W=h,N=i,U=a;t/=G,r/=W;var L=this.vertices,R=this.vertexIndex*this.vertSize;if(p){var k=i;i=a/G,a=k/W,L[R++]=b,L[R++]=T,L[R++]=i+t,L[R++]=r,L[R++]=g,L[R++]=x*N+b,L[R++]=m*N+T,L[R++]=i+t,L[R++]=a+r,L[R++]=g,L[R++]=x*N+y*U+b,L[R++]=w*U+m*N+T,L[R++]=t,L[R++]=a+r,L[R++]=g,L[R++]=y*U+b,L[R++]=w*U+T,L[R++]=t,L[R++]=r,L[R++]=g}else i/=G,a/=W,L[R++]=b,L[R++]=T,L[R++]=t,L[R++]=r,L[R++]=g,L[R++]=x*N+b,L[R++]=m*N+T,L[R++]=i+t,L[R++]=r,L[R++]=g,L[R++]=x*N+y*U+b,L[R++]=w*U+m*N+T,L[R++]=i+t,L[R++]=a+r,L[R++]=g,L[R++]=y*U+b,L[R++]=w*U+T,L[R++]=t,L[R++]=a+r,L[R++]=g;if(this.hasMesh){var H=this.indicesForMesh;H[this.indexIndex+0]=0+this.vertexIndex,H[this.indexIndex+1]=1+this.vertexIndex,H[this.indexIndex+2]=2+this.vertexIndex,H[this.indexIndex+3]=0+this.vertexIndex,H[this.indexIndex+4]=2+this.vertexIndex,H[this.indexIndex+5]=3+this.vertexIndex}this.vertexIndex+=4,this.indexIndex+=6}},e.prototype.clear=function(){this.hasMesh=!1,this.vertexIndex=0,this.indexIndex=0},e}();e.WebGLVertexArrayObject=t,__reflect(t.prototype,"egret.wxgame.WebGLVertexArrayObject")}(t=e.wxgame||(e.wxgame={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(t){function r(e,r,i){var a=t.call(this)||this;return a.clearColor=[0,0,0,0],a.useFrameBuffer=!0,a.gl=e,a.width=r||1,a.height=i||1,a}return __extends(r,t),r.prototype.resize=function(e,t){var r=this.gl;this.width=e,this.height=t,this.frameBuffer&&(r.bindTexture(r.TEXTURE_2D,this.texture),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e,t,0,r.RGBA,r.UNSIGNED_BYTE,null)),this.stencilBuffer&&(r.deleteRenderbuffer(this.stencilBuffer),this.stencilBuffer=null)},r.prototype.activate=function(){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,this.getFrameBuffer())},r.prototype.getFrameBuffer=function(){return this.useFrameBuffer?this.frameBuffer:null},r.prototype.initFrameBuffer=function(){if(!this.frameBuffer){var e=this.gl;this.texture=this.createTexture(),this.frameBuffer=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture,0)}},r.prototype.createTexture=function(){var e=this.gl,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),t},r.prototype.clear=function(e){var t=this.gl;e&&this.activate(),t.colorMask(!0,!0,!0,!0),t.clearColor(this.clearColor[0],this.clearColor[1],this.clearColor[2],this.clearColor[3]),t.clear(t.COLOR_BUFFER_BIT)},r.prototype.enabledStencil=function(){if(this.frameBuffer&&!this.stencilBuffer){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer),this.stencilBuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,this.stencilBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,this.width,this.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,this.stencilBuffer)}},r.prototype.dispose=function(){e.WebGLUtils.deleteWebGLTexture(this.texture)},r}(e.HashObject);t.WebGLRenderTarget=r,__reflect(r.prototype,"egret.wxgame.WebGLRenderTarget")}(t=e.wxgame||(e.wxgame={}))}(egret||(egret={}));var egret;!function(e){var t;!function(e){var t=function(){function t(t,r){this.glID=null,this.projectionX=0/0,this.projectionY=0/0,this.contextLost=!1,this.$scissorState=!1,this.vertSize=5,this.surface=window.canvas,this.initWebGL(),this.$bufferStack=[];var i=this.context;this.vertexBuffer=i.createBuffer(),this.indexBuffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.vertexBuffer),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this.indexBuffer),this.drawCmdManager=new e.WebGLDrawCmdManager,this.vao=new e.WebGLVertexArrayObject,this.setGlobalCompositeOperation("source-over")}return t.getInstance=function(e,r){return this.instance?this.instance:(this.instance=new t(e,r),this.instance)},t.prototype.pushBuffer=function(e){this.$bufferStack.push(e),e!=this.currentBuffer&&(this.currentBuffer,this.drawCmdManager.pushActivateBuffer(e)),this.currentBuffer=e},t.prototype.popBuffer=function(){if(!(this.$bufferStack.length<=1)){var e=this.$bufferStack.pop(),t=this.$bufferStack[this.$bufferStack.length-1];e!=t&&this.drawCmdManager.pushActivateBuffer(t),this.currentBuffer=t}},t.prototype.activateBuffer=function(e,t,r){e.rootRenderTarget.activate(),this.bindIndices||this.uploadIndicesArray(this.vao.getIndices()),e.restoreStencil(),e.restoreScissor(),this.onResize(t,r)},t.prototype.uploadVerticesArray=function(e){var t=this.context;t.bufferData(t.ARRAY_BUFFER,e,t.STREAM_DRAW)},t.prototype.uploadIndicesArray=function(e){var t=this.context;t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW),this.bindIndices=!0},t.prototype.destroy=function(){this.surface.width=this.surface.height=0},t.prototype.onResize=function(e,t){e=e||this.surface.width,t=t||this.surface.height,this.projectionX=e/2,this.projectionY=-t/2,this.context&&this.context.viewport(0,0,e,t)},t.prototype.resize=function(t,r,i){var a=this.surface;i?(a.width<t&&(a.width=t,!e.isSubContext&&window.sharedCanvas&&(window.sharedCanvas.width=t)),a.height<r&&(a.height=r,!e.isSubContext&&window.sharedCanvas&&(window.sharedCanvas.height=r))):(a.width!=t&&(a.width=t,!e.isSubContext&&window.sharedCanvas&&(window.sharedCanvas.width=t)),a.height!=r&&(a.height=r,!e.isSubContext&&window.sharedCanvas&&(window.sharedCanvas.height=r))),this.onResize()},t.prototype.initWebGL=function(){this.onResize(),this.surface.addEventListener("webglcontextlost",this.handleContextLost.bind(this),!1),this.surface.addEventListener("webglcontextrestored",this.handleContextRestored.bind(this),!1),this.getWebGLContext();var e=this.context;this.$maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE)},t.prototype.handleContextLost=function(){this.contextLost=!0},t.prototype.handleContextRestored=function(){this.initWebGL(),this.contextLost=!1},t.prototype.getWebGLContext=function(){this.setContext(window.canvas.getContext("webgl"))},t.prototype.setContext=function(e){this.context=e,e.id=t.glContextId++,this.glID=e.id,e.disable(e.DEPTH_TEST),e.disable(e.CULL_FACE),e.enable(e.BLEND),e.colorMask(!0,!0,!0,!0),e.activeTexture(e.TEXTURE0)},t.prototype.enableStencilTest=function(){var e=this.context;e.enable(e.STENCIL_TEST)},t.prototype.disableStencilTest=function(){var e=this.context;e.disable(e.STENCIL_TEST)},t.prototype.enableScissorTest=function(e){var t=this.context;t.enable(t.SCISSOR_TEST),t.scissor(e.x,e.y,e.width,e.height)},t.prototype.disableScissorTest=function(){var e=this.context;e.disable(e.SCISSOR_TEST)},t.prototype.getPixels=function(e,t,r,i,a){var n=this.context;n.readPixels(e,t,r,i,n.RGBA,n.UNSIGNED_BYTE,a)},t.prototype.createTexture=function(e){var t=this.context;if(e.isCanvas&&null!=t.wxBindCanvasTexture)return e;var r=t.createTexture();return r?(r.glContext=t,t.bindTexture(t.TEXTURE_2D,r),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),r):void(this.contextLost=!0)},t.prototype.createTextureFromCompressedData=function(e,t,r,i,a){return null},t.prototype.updateTexture=function(e,t){var r=this.context;r.bindTexture(r.TEXTURE_2D,e),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t)},t.prototype.getWebGLTexture=function(e){return e.webGLTexture||("image"==e.format?e.webGLTexture=this.createTexture(e.source):"pvr"==e.format&&(e.webGLTexture=this.createTextureFromCompressedData(e.source.pvrtcData,e.width,e.height,e.source.mipmapsCount,e.source.format)),e.$deleteSource&&e.webGLTexture&&(e.source=null),e.webGLTexture.smoothing=!0),e.webGLTexture},t.prototype.clearRect=function(e,t,r,i){if(0!=e||0!=t||r!=this.surface.width||i!=this.surface.height){var a=this.currentBuffer;if(a.$hasScissor)this.setGlobalCompositeOperation("destination-out"),this.drawRect(e,t,r,i),this.setGlobalCompositeOperation("source-over");else{var n=a.globalMatrix;0==n.b&&0==n.c?(e=e*n.a+n.tx,t=t*n.d+n.ty,r*=n.a,i*=n.d,this.enableScissor(e,-t-i+a.height,r,i),this.clear(),this.disableScissor()):(this.setGlobalCompositeOperation("destination-out"),this.drawRect(e,t,r,i),this.setGlobalCompositeOperation("source-over"))}}else this.clear()},t.prototype.setGlobalCompositeOperation=function(e){this.drawCmdManager.pushSetBlend(e)},t.prototype.drawImage=function(e,t,r,i,a,n,o,s,c,u,h,d,l){var f=this.currentBuffer;if(!this.contextLost&&e&&f){var p,g,v;if(e.texture||e.source&&e.source.texture)p=e.texture||e.source.texture,f.saveTransform(),g=f.$offsetX,v=f.$offsetY,f.useOffset(),f.transform(1,0,0,-1,0,c+2*o);else{if(!e.source&&!e.webGLTexture)return;p=this.getWebGLTexture(e)}p&&(this.drawTexture(p,t,r,i,a,n,o,s,c,u,h,void 0,void 0,void 0,void 0,d,l),e.source&&e.source.texture&&(f.$offsetX=g,f.$offsetY=v,f.restoreTransform()))}},t.prototype.drawMesh=function(e,t,r,i,a,n,o,s,c,u,h,d,l,f,p,g,v){var x=this.currentBuffer;if(!this.contextLost&&e&&x){var m,y,w;if(e.texture||e.source&&e.source.texture)m=e.texture||e.source.texture,x.saveTransform(),y=x.$offsetX,w=x.$offsetY,x.useOffset(),x.transform(1,0,0,-1,0,c+2*o);else{if(!e.source&&!e.webGLTexture)return;m=this.getWebGLTexture(e)}m&&(this.drawTexture(m,t,r,i,a,n,o,s,c,u,h,d,l,f,p,g,v),(e.texture||e.source&&e.source.texture)&&(x.$offsetX=y,x.$offsetY=w,x.restoreTransform()))}},t.prototype.drawTexture=function(e,t,r,i,a,n,o,s,c,u,h,d,l,f,p,g,v){var x=this.currentBuffer;if(!this.contextLost&&e&&x){l&&f?this.vao.reachMaxSize(l.length/2,f.length)&&this.$drawWebGL():this.vao.reachMaxSize()&&this.$drawWebGL(),void 0!=v&&e.smoothing!=v&&this.drawCmdManager.pushChangeSmoothing(e,v),d&&this.vao.changeToMeshIndices();var m=f?f.length/3:2;this.drawCmdManager.pushDrawTexture(e,m,this.$filter),this.vao.cacheArrays(x,t,r,i,a,n,o,s,c,u,h,d,l,f,g)}},t.prototype.drawRect=function(e,t,r,i){var a=this.currentBuffer;!this.contextLost&&a&&(this.vao.reachMaxSize()&&this.$drawWebGL(),this.drawCmdManager.pushDrawRect(),this.vao.cacheArrays(a,0,0,r,i,e,t,r,i,r,i))},t.prototype.pushMask=function(e,t,r,i){var a=this.currentBuffer;!this.contextLost&&a&&(a.$stencilList.push({x:e,y:t,width:r,height:i}),this.vao.reachMaxSize()&&this.$drawWebGL(),this.drawCmdManager.pushPushMask(),this.vao.cacheArrays(a,0,0,r,i,e,t,r,i,r,i))},t.prototype.popMask=function(){var e=this.currentBuffer;if(!this.contextLost&&e){var t=e.$stencilList.pop();this.vao.reachMaxSize()&&this.$drawWebGL(),this.drawCmdManager.pushPopMask(),this.vao.cacheArrays(e,0,0,t.width,t.height,t.x,t.y,t.width,t.height,t.width,t.height)}},t.prototype.clear=function(){this.drawCmdManager.pushClearColor()},t.prototype.enableScissor=function(e,t,r,i){var a=this.currentBuffer;this.drawCmdManager.pushEnableScissor(e,t,r,i),a.$hasScissor=!0},t.prototype.disableScissor=function(){var e=this.currentBuffer;this.drawCmdManager.pushDisableScissor(),e.$hasScissor=!1},t.prototype.$drawWebGL=function(){if(0!=this.drawCmdManager.drawDataLen&&!this.contextLost){this.uploadVerticesArray(this.vao.getVertices()),this.vao.isMesh()&&this.uploadIndicesArray(this.vao.getMeshIndices());for(var e=this.drawCmdManager.drawDataLen,t=0,r=0;e>r;r++){var i=this.drawCmdManager.drawData[r];t=this.drawData(i,t),6==i.type&&(this.activatedBuffer=i.buffer),(0==i.type||11==i.type||1==i.type||2==i.type)&&this.activatedBuffer&&this.activatedBuffer.$computeDrawCall&&this.activatedBuffer.$drawCalls++}this.vao.isMesh()&&this.uploadIndicesArray(this.vao.getIndices()),this.drawCmdManager.clear(),this.vao.clear()}},t.prototype.drawData=function(t,r){if(t){var i,a=this.context,n=t.filter;switch(t.type){case 0:n?"custom"===n.type?i=e.EgretWebGLProgram.getProgram(a,n.$vertexSrc,n.$fragmentSrc,n.$shaderKey):"colorTransform"===n.type?i=e.EgretWebGLProgram.getProgram(a,e.EgretShaderLib.default_vert,e.EgretShaderLib.colorTransform_frag,"colorTransform"):"blurX"===n.type?i=e.EgretWebGLProgram.getProgram(a,e.EgretShaderLib.default_vert,e.EgretShaderLib.blur_frag,"blur"):"blurY"===n.type?i=e.EgretWebGLProgram.getProgram(a,e.EgretShaderLib.default_vert,e.EgretShaderLib.blur_frag,"blur"):"glow"===n.type&&(i=e.EgretWebGLProgram.getProgram(a,e.EgretShaderLib.default_vert,e.EgretShaderLib.glow_frag,"glow")):i=e.EgretWebGLProgram.getProgram(a,e.EgretShaderLib.default_vert,e.EgretShaderLib.texture_frag,"texture"),this.activeProgram(a,i),this.syncUniforms(i,n,t.textureWidth,t.textureHeight),r+=this.drawTextureElements(t,r);break;case 11:i=e.EgretWebGLProgram.getProgram(a,e.EgretShaderLib.default_vert,e.EgretShaderLib.primitive_frag,"primitive"),this.activeProgram(a,i),this.syncUniforms(i,n,t.textureWidth,t.textureHeight),r+=this.drawRectElements(t,r);break;case 1:i=e.EgretWebGLProgram.getProgram(a,e.EgretShaderLib.default_vert,e.EgretShaderLib.primitive_frag,"primitive"),this.activeProgram(a,i),this.syncUniforms(i,n,t.textureWidth,t.textureHeight),r+=this.drawPushMaskElements(t,r);
break;case 2:i=e.EgretWebGLProgram.getProgram(a,e.EgretShaderLib.default_vert,e.EgretShaderLib.primitive_frag,"primitive"),this.activeProgram(a,i),this.syncUniforms(i,n,t.textureWidth,t.textureHeight),r+=this.drawPopMaskElements(t,r);break;case 3:this.setBlendMode(t.value);break;case 4:t.buffer.rootRenderTarget.resize(t.width,t.height),this.onResize(t.width,t.height);break;case 5:if(this.activatedBuffer){var o=this.activatedBuffer.rootRenderTarget;(0!=o.width||0!=o.height)&&o.clear(!0)}break;case 6:this.activateBuffer(t.buffer,t.width,t.height);break;case 7:var s=this.activatedBuffer;s&&(s.rootRenderTarget&&s.rootRenderTarget.enabledStencil(),s.enableScissor(t.x,t.y,t.width,t.height));break;case 8:s=this.activatedBuffer,s&&s.disableScissor();break;case 9:a.bindTexture(a.TEXTURE_2D,t.texture),t.smoothing?(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR)):(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST))}return r}},t.prototype.activeProgram=function(e,t){if(t!=this.currentProgram){e.useProgram(t.id);var r=t.attributes;for(var i in r)"aVertexPosition"===i?(e.vertexAttribPointer(r.aVertexPosition.location,2,e.FLOAT,!1,20,0),e.enableVertexAttribArray(r.aVertexPosition.location)):"aTextureCoord"===i?(e.vertexAttribPointer(r.aTextureCoord.location,2,e.FLOAT,!1,20,8),e.enableVertexAttribArray(r.aTextureCoord.location)):"aColor"===i&&(e.vertexAttribPointer(r.aColor.location,1,e.FLOAT,!1,20,16),e.enableVertexAttribArray(r.aColor.location));this.currentProgram=t}},t.prototype.syncUniforms=function(e,t,r,i){var a=e.uniforms;t&&"custom"===t.type;for(var n in a)if("projectionVector"===n)a[n].setValue({x:this.projectionX,y:this.projectionY});else if("uTextureSize"===n)a[n].setValue({x:r,y:i});else if("uSampler"===n);else{var o=t.$uniforms[n];void 0!==o&&a[n].setValue(o)}},t.prototype.drawTextureElements=function(e,t){var r=this.context;e.texture.isCanvas?r.wxBindCanvasTexture(r.TEXTURE_2D,e.texture):r.bindTexture(r.TEXTURE_2D,e.texture);var i=3*e.count;return r.drawElements(r.TRIANGLES,i,r.UNSIGNED_SHORT,2*t),i},t.prototype.drawRectElements=function(e,t){var r=this.context,i=3*e.count;return r.drawElements(r.TRIANGLES,i,r.UNSIGNED_SHORT,2*t),i},t.prototype.drawPushMaskElements=function(e,t){var r=this.context,i=3*e.count,a=this.activatedBuffer;if(a){a.rootRenderTarget&&a.rootRenderTarget.enabledStencil(),0==a.stencilHandleCount&&(a.enableStencil(),r.clear(r.STENCIL_BUFFER_BIT));var n=a.stencilHandleCount;a.stencilHandleCount++,r.colorMask(!1,!1,!1,!1),r.stencilFunc(r.EQUAL,n,255),r.stencilOp(r.KEEP,r.KEEP,r.INCR),r.drawElements(r.TRIANGLES,i,r.UNSIGNED_SHORT,2*t),r.stencilFunc(r.EQUAL,n+1,255),r.colorMask(!0,!0,!0,!0),r.stencilOp(r.KEEP,r.KEEP,r.KEEP)}return i},t.prototype.drawPopMaskElements=function(e,t){var r=this.context,i=3*e.count,a=this.activatedBuffer;if(a)if(a.stencilHandleCount--,0==a.stencilHandleCount)a.disableStencil();else{var n=a.stencilHandleCount;r.colorMask(!1,!1,!1,!1),r.stencilFunc(r.EQUAL,n+1,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR),r.drawElements(r.TRIANGLES,i,r.UNSIGNED_SHORT,2*t),r.stencilFunc(r.EQUAL,n,255),r.colorMask(!0,!0,!0,!0),r.stencilOp(r.KEEP,r.KEEP,r.KEEP)}return i},t.prototype.setBlendMode=function(e){var r=this.context,i=t.blendModesForGL[e];i&&r.blendFunc(i[0],i[1])},t.prototype.drawTargetWidthFilters=function(t,r){var i,a=r,n=t.length;if(n>1)for(var o=0;n-1>o;o++){var s=t[o],c=r.rootRenderTarget.width,u=r.rootRenderTarget.height;i=e.WebGLRenderBuffer.create(c,u),i.setTransform(1,0,0,1,0,0),i.globalAlpha=1,this.drawToRenderTarget(s,r,i),r!=a&&e.WebGLRenderBuffer.release(r),r=i}var h=t[n-1];this.drawToRenderTarget(h,r,this.currentBuffer),r!=a&&e.WebGLRenderBuffer.release(r)},t.prototype.drawToRenderTarget=function(t,r,i){if(!this.contextLost){this.vao.reachMaxSize()&&this.$drawWebGL(),this.pushBuffer(i);var a,n=r,o=r.rootRenderTarget.width,s=r.rootRenderTarget.height;if("blur"==t.type){var c=t.blurXFilter,u=t.blurYFilter;0!=c.blurX&&0!=u.blurY?(a=e.WebGLRenderBuffer.create(o,s),a.setTransform(1,0,0,1,0,0),a.globalAlpha=1,this.drawToRenderTarget(t.blurXFilter,r,a),r!=n&&e.WebGLRenderBuffer.release(r),r=a,t=u):t=0===c.blurX?u:c}i.saveTransform(),i.transform(1,0,0,-1,0,s),this.vao.cacheArrays(i,0,0,o,s,0,0,o,s,o,s),i.restoreTransform(),this.drawCmdManager.pushDrawTexture(r.rootRenderTarget.texture,2,t,o,s),r!=n&&e.WebGLRenderBuffer.release(r),this.popBuffer()}},t.initBlendMode=function(){t.blendModesForGL={},t.blendModesForGL["source-over"]=[1,771],t.blendModesForGL.lighter=[1,1],t.blendModesForGL["lighter-in"]=[770,771],t.blendModesForGL["destination-out"]=[0,771],t.blendModesForGL["destination-in"]=[0,770]},t.glContextId=0,t.blendModesForGL=null,t}();e.WebGLRenderContext=t,__reflect(t.prototype,"egret.wxgame.WebGLRenderContext"),t.initBlendMode()}(t=e.wxgame||(e.wxgame={}))}(egret||(egret={})),window.sharedCanvas.isCanvas=!0;var egret;!function(e){var t;!function(t){var r=function(r){function a(i,a,n){var o=r.call(this)||this;if(o.globalAlpha=1,o.stencilState=!1,o.$stencilList=[],o.stencilHandleCount=0,o.$scissorState=!1,o.scissorRect=new e.Rectangle,o.$hasScissor=!1,o.$drawCalls=0,o.$computeDrawCall=!1,o.globalMatrix=new e.Matrix,o.savedGlobalMatrix=new e.Matrix,o.$offsetX=0,o.$offsetY=0,o.context=t.WebGLRenderContext.getInstance(i,a),o.rootRenderTarget=new t.WebGLRenderTarget(o.context.context,3,3),i&&a&&o.resize(i,a),o.root=n,o.root)o.context.pushBuffer(o),o.surface=o.context.surface,o.$computeDrawCall=!0;else{var s=o.context.activatedBuffer;s&&s.rootRenderTarget.activate(),o.rootRenderTarget.initFrameBuffer(),o.surface=o.rootRenderTarget}return o}return __extends(a,r),a.prototype.enableStencil=function(){this.stencilState||(this.context.enableStencilTest(),this.stencilState=!0)},a.prototype.disableStencil=function(){this.stencilState&&(this.context.disableStencilTest(),this.stencilState=!1)},a.prototype.restoreStencil=function(){this.stencilState?this.context.enableStencilTest():this.context.disableStencilTest()},a.prototype.enableScissor=function(e,t,r,i){this.$scissorState||(this.$scissorState=!0,this.scissorRect.setTo(e,t,r,i),this.context.enableScissorTest(this.scissorRect))},a.prototype.disableScissor=function(){this.$scissorState&&(this.$scissorState=!1,this.scissorRect.setEmpty(),this.context.disableScissorTest())},a.prototype.restoreScissor=function(){this.$scissorState?this.context.enableScissorTest(this.scissorRect):this.context.disableScissorTest()},Object.defineProperty(a.prototype,"width",{get:function(){return this.rootRenderTarget.width},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"height",{get:function(){return this.rootRenderTarget.height},enumerable:!0,configurable:!0}),a.prototype.resize=function(e,t,r){this.context.pushBuffer(this),e=e||1,t=t||1,(e!=this.rootRenderTarget.width||t!=this.rootRenderTarget.height)&&(this.context.drawCmdManager.pushResize(this,e,t),this.rootRenderTarget.width=e,this.rootRenderTarget.height=t),this.root&&this.context.resize(e,t,r),this.context.clear(),this.context.popBuffer()},a.prototype.getPixels=function(e,t,r,i){void 0===r&&(r=1),void 0===i&&(i=1);var a=new Uint8Array(4*r*i),n=this.rootRenderTarget.useFrameBuffer;this.rootRenderTarget.useFrameBuffer=!0,this.rootRenderTarget.activate(),this.context.getPixels(e,t,r,i,a),this.rootRenderTarget.useFrameBuffer=n,this.rootRenderTarget.activate();for(var o=new Uint8Array(4*r*i),s=0;i>s;s++)for(var c=0;r>c;c++)o[4*(r*(i-s-1)+c)]=a[4*(r*s+c)],o[4*(r*(i-s-1)+c)+1]=a[4*(r*s+c)+1],o[4*(r*(i-s-1)+c)+2]=a[4*(r*s+c)+2],o[4*(r*(i-s-1)+c)+3]=a[4*(r*s+c)+3];return o},a.prototype.$pushResize=function(e,t){this.context.drawCmdManager.pushResize(this,e,t)},a.prototype.toDataURL=function(e,t){return this.context.surface.toDataURL(e,t)},a.prototype.destroy=function(){this.context.destroy()},a.prototype.onRenderFinish=function(){this.$drawCalls=0},a.prototype.drawFrameBufferToSurface=function(e,t,r,i,a,n,o,s,c){void 0===c&&(c=!1),this.rootRenderTarget.useFrameBuffer=!1,this.rootRenderTarget.activate(),this.context.disableStencilTest(),this.context.disableScissorTest(),this.setTransform(1,0,0,1,0,0),this.globalAlpha=1,this.context.setGlobalCompositeOperation("source-over"),c&&this.context.clear(),this.context.drawImage(this.rootRenderTarget,e,t,r,i,a,n,o,s,r,i,!1),this.context.$drawWebGL(),this.rootRenderTarget.useFrameBuffer=!0,this.rootRenderTarget.activate(),this.restoreStencil(),this.restoreScissor()},a.prototype.drawSurfaceToFrameBuffer=function(e,t,r,i,a,n,o,s,c){void 0===c&&(c=!1),this.rootRenderTarget.useFrameBuffer=!0,this.rootRenderTarget.activate(),this.context.disableStencilTest(),this.context.disableScissorTest(),this.setTransform(1,0,0,1,0,0),this.globalAlpha=1,this.context.setGlobalCompositeOperation("source-over"),c&&this.context.clear(),this.context.drawImage(this.context.surface,e,t,r,i,a,n,o,s,r,i,!1),this.context.$drawWebGL(),this.rootRenderTarget.useFrameBuffer=!1,this.rootRenderTarget.activate(),this.restoreStencil(),this.restoreScissor()},a.prototype.clear=function(){this.context.pushBuffer(this),this.context.clear(),this.context.popBuffer()},a.prototype.setTransform=function(e,t,r,i,a,n){var o=this.globalMatrix;o.a=e,o.b=t,o.c=r,o.d=i,o.tx=a,o.ty=n},a.prototype.transform=function(e,t,r,i,a,n){var o=this.globalMatrix,s=o.a,c=o.b,u=o.c,h=o.d;(1!=e||0!=t||0!=r||1!=i)&&(o.a=e*s+t*u,o.b=e*c+t*h,o.c=r*s+i*u,o.d=r*c+i*h),o.tx=a*s+n*u+o.tx,o.ty=a*c+n*h+o.ty},a.prototype.translate=function(e,t){var r=this.globalMatrix;r.tx+=e,r.ty+=t},a.prototype.useOffset=function(){var e=this;(0!=e.$offsetX||0!=e.$offsetY)&&(e.globalMatrix.append(1,0,0,1,e.$offsetX,e.$offsetY),e.$offsetX=e.$offsetY=0)},a.prototype.saveTransform=function(){var e=this.globalMatrix,t=this.savedGlobalMatrix;t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t.tx=e.tx,t.ty=e.ty},a.prototype.restoreTransform=function(){var e=this.globalMatrix,t=this.savedGlobalMatrix;e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e.tx=t.tx,e.ty=t.ty},a.create=function(e,t){var r=i.pop();if(r){r.resize(e,t);var n=r.globalMatrix;n.a=1,n.b=0,n.c=0,n.d=1,n.tx=0,n.ty=0,r.globalAlpha=1,r.$offsetX=0,r.$offsetY=0}else r=new a(e,t),r.$computeDrawCall=!1;return r},a.release=function(e){i.push(e)},a.autoClear=!0,a}(e.HashObject);t.WebGLRenderBuffer=r,__reflect(r.prototype,"egret.wxgame.WebGLRenderBuffer",["egret.sys.RenderBuffer"]);var i=[]}(t=e.wxgame||(e.wxgame={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=["source-over","lighter","destination-out"],i="source-over",a=[],n=function(){function n(){this.nestLevel=0}return n.prototype.render=function(t,r,i,n){this.nestLevel++;var o=r,s=o.context;s.pushBuffer(o),o.transform(i.a,i.b,i.c,i.d,0,0),this.drawDisplayObject(t,o,i.tx,i.ty,!0),s.$drawWebGL();var c=o.$drawCalls;o.onRenderFinish(),s.popBuffer();var u=e.Matrix.create();if(i.$invertInto(u),o.transform(u.a,u.b,u.c,u.d,0,0),e.Matrix.release(u),this.nestLevel--,0===this.nestLevel){a.length>6&&(a.length=6);for(var h=a.length,d=0;h>d;d++)a[d].resize(0,0)}return c},n.prototype.drawDisplayObject=function(t,r,i,a,n){var o,s=0,c=t.$displayList;if(c&&!n?((t.$cacheDirty||t.$renderDirty||c.$canvasScaleX!=e.sys.DisplayList.$canvasScaleX||c.$canvasScaleY!=e.sys.DisplayList.$canvasScaleY)&&(s+=c.drawToSurface()),o=c.$renderNode):o=t.$renderDirty?t.$getRenderNode():t.$renderNode,t.$cacheDirty=!1,o){switch(s++,r.$offsetX=i,r.$offsetY=a,o.type){case 1:this.renderBitmap(o,r);break;case 2:this.renderText(o,r);break;case 3:this.renderGraphics(o,r);break;case 4:this.renderGroup(o,r);break;case 5:this.renderMesh(o,r);break;case 6:this.renderNormalBitmap(o,r)}r.$offsetX=0,r.$offsetY=0}if(c&&!n)return s;var u=t.$children;if(u)for(var h=u.length,d=0;h>d;d++){var l=u[d],f=void 0,p=void 0,g=void 0;1!=l.$alpha&&(g=r.globalAlpha,r.globalAlpha*=l.$alpha);var v=void 0;if(l.$useTranslate){var x=l.$getMatrix();f=i+l.$x,p=a+l.$y;var m=r.globalMatrix;v=e.Matrix.create(),v.a=m.a,v.b=m.b,v.c=m.c,v.d=m.d,v.tx=m.tx,v.ty=m.ty,r.transform(x.a,x.b,x.c,x.d,f,p),f=-l.$anchorOffsetX,p=-l.$anchorOffsetY}else f=i+l.$x-l.$anchorOffsetX,p=a+l.$y-l.$anchorOffsetY;switch(l.$renderMode){case 1:break;case 2:s+=this.drawWithFilter(l,r,f,p);break;case 3:s+=this.drawWithClip(l,r,f,p);break;case 4:s+=this.drawWithScrollRect(l,r,f,p);break;default:s+=this.drawDisplayObject(l,r,f,p)}if(g&&(r.globalAlpha=g),v){var x=r.globalMatrix;x.a=v.a,x.b=v.b,x.c=v.c,x.d=v.d,x.tx=v.tx,x.ty=v.ty,e.Matrix.release(v)}}return s},n.prototype.drawWithFilter=function(t,n,o,s){var c=0;if(t.$children&&0==t.$children.length&&(!t.$renderNode||0==t.$renderNode.$getRenderCount()))return c;var u,h=t.$filters,d=0!==t.$blendMode;d&&(u=r[t.$blendMode],u||(u=i));var l=t.$getOriginalBounds(),f=l.x,p=l.y,g=l.width,v=l.height;if(0>=g||0>=v)return c;if(!t.mask&&1==h.length&&("colorTransform"==h[0].type||"custom"===h[0].type&&0===h[0].padding)){var x=this.getRenderCount(t);if(!t.$children||1==x)return d&&n.context.setGlobalCompositeOperation(u),n.context.$filter=h[0],c+=t.$mask?this.drawWithClip(t,n,o,s):t.$scrollRect||t.$maskRect?this.drawWithScrollRect(t,n,o,s):this.drawDisplayObject(t,n,o,s),n.context.$filter=null,d&&n.context.setGlobalCompositeOperation(i),c}var m=this.createRenderBuffer(g,v);if(m.context.pushBuffer(m),c+=t.$mask?this.drawWithClip(t,m,-f,-p):t.$scrollRect||t.$maskRect?this.drawWithScrollRect(t,m,-f,-p):this.drawDisplayObject(t,m,-f,-p),m.context.popBuffer(),c>0){d&&n.context.setGlobalCompositeOperation(u),c++,n.$offsetX=o+f,n.$offsetY=s+p;var y=e.Matrix.create(),w=n.globalMatrix;y.a=w.a,y.b=w.b,y.c=w.c,y.d=w.d,y.tx=w.tx,y.ty=w.ty,n.useOffset(),n.context.drawTargetWidthFilters(h,m),w.a=y.a,w.b=y.b,w.c=y.c,w.d=y.d,w.tx=y.tx,w.ty=y.ty,e.Matrix.release(y),d&&n.context.setGlobalCompositeOperation(i)}return a.push(m),c},n.prototype.getRenderCount=function(e){var t=0,r=e.$getRenderNode();if(r&&(t+=r.$getRenderCount()),e.$children)for(var i=0,a=e.$children;i<a.length;i++){var n=a[i],o=n.$filters;if(o&&o.length>0)return 2;if(n.$children)t+=this.getRenderCount(n);else{var s=n.$getRenderNode();s&&(t+=s.$getRenderCount())}}return t},n.prototype.drawWithClip=function(t,n,o,s){var c,u=0,h=0!==t.$blendMode;h&&(c=r[t.$blendMode],c||(c=i));var d=t.$scrollRect?t.$scrollRect:t.$maskRect,l=t.$mask;if(l){var f=l.$getMatrix();if(0==f.a&&0==f.b||0==f.c&&0==f.d)return u}if(l||t.$children&&0!=t.$children.length){var p=t.$getOriginalBounds(),g=p.x,v=p.y,x=p.width,m=p.height,y=this.createRenderBuffer(x,m);if(y.context.pushBuffer(y),u+=this.drawDisplayObject(t,y,-g,-v),l){var w=this.createRenderBuffer(x,m);w.context.pushBuffer(w);var b=e.Matrix.create();b.copyFrom(l.$getConcatenatedMatrix()),l.$getConcatenatedMatrixAt(t,b),b.translate(-g,-v),w.setTransform(b.a,b.b,b.c,b.d,b.tx,b.ty),e.Matrix.release(b),u+=this.drawDisplayObject(l,w,0,0),w.context.popBuffer(),y.context.setGlobalCompositeOperation("destination-in"),y.setTransform(1,0,0,-1,0,w.height);var T=w.rootRenderTarget.width,E=w.rootRenderTarget.height;y.context.drawTexture(w.rootRenderTarget.texture,0,0,T,E,0,0,T,E,T,E),y.setTransform(1,0,0,1,0,0),y.context.setGlobalCompositeOperation("source-over"),w.setTransform(1,0,0,1,0,0),a.push(w)}if(y.context.setGlobalCompositeOperation(i),y.context.popBuffer(),u>0){u++,h&&n.context.setGlobalCompositeOperation(c),d&&n.context.pushMask(d.x+o,d.y+s,d.width,d.height);var C=e.Matrix.create(),S=n.globalMatrix;C.a=S.a,C.b=S.b,C.c=S.c,C.d=S.d,C.tx=S.tx,C.ty=S.ty,S.append(1,0,0,-1,o+g,s+v+y.height);var _=y.rootRenderTarget.width,L=y.rootRenderTarget.height;n.context.drawTexture(y.rootRenderTarget.texture,0,0,_,L,0,0,_,L,_,L),d&&y.context.popMask(),h&&n.context.setGlobalCompositeOperation(i);var R=n.globalMatrix;R.a=C.a,R.b=C.b,R.c=C.c,R.d=C.d,R.tx=C.tx,R.ty=C.ty,e.Matrix.release(C)}return a.push(y),u}return d&&n.context.pushMask(d.x+o,d.y+s,d.width,d.height),h&&n.context.setGlobalCompositeOperation(c),u+=this.drawDisplayObject(t,n,o,s),h&&n.context.setGlobalCompositeOperation(i),d&&n.context.popMask(),u},n.prototype.drawWithScrollRect=function(e,t,r,i){var a=0,n=e.$scrollRect?e.$scrollRect:e.$maskRect;if(n.isEmpty())return a;e.$scrollRect&&(r-=n.x,i-=n.y);var o=t.globalMatrix,s=t.context,c=!1;if(t.$hasScissor||0!=o.b||0!=o.c)t.context.pushMask(n.x+r,n.y+i,n.width,n.height);else{var u=o.a,h=o.d,d=o.tx,l=o.ty,f=n.x+r,p=n.y+i,g=f+n.width,v=p+n.height,x=void 0,m=void 0,y=void 0,w=void 0;if(1==u&&1==h)x=f+d,m=p+l,y=g+d,w=v+l;else{var b=u*f+d,T=h*p+l,E=u*g+d,C=h*p+l,S=u*g+d,_=h*v+l,L=u*f+d,R=h*v+l,A=0;b>E&&(A=b,b=E,E=A),S>L&&(A=S,S=L,L=A),x=S>b?b:S,y=E>L?E:L,T>C&&(A=T,T=C,C=A),_>R&&(A=_,_=R,R=A),m=_>T?T:_,w=C>R?C:R}s.enableScissor(x,-w+t.height,y-x,w-m),c=!0}return a+=this.drawDisplayObject(e,t,r,i),c?s.disableScissor():s.popMask(),a},n.prototype.drawNodeToBuffer=function(e,t,r,i){var a=t;a.context.pushBuffer(a),a.setTransform(r.a,r.b,r.c,r.d,r.tx,r.ty),this.renderNode(e,t,0,0,i),a.context.$drawWebGL(),a.onRenderFinish(),a.context.popBuffer()},n.prototype.drawDisplayToBuffer=function(e,t,r){t.context.pushBuffer(t),r&&t.setTransform(r.a,r.b,r.c,r.d,r.tx,r.ty);var i;i=e.$renderDirty?e.$getRenderNode():e.$renderNode;var a=0;if(i)switch(a++,i.type){case 1:this.renderBitmap(i,t);break;case 2:this.renderText(i,t);break;case 3:this.renderGraphics(i,t);break;case 4:this.renderGroup(i,t);break;case 5:this.renderMesh(i,t);break;case 6:this.renderNormalBitmap(i,t)}var n=e.$children;if(n)for(var o=n.length,s=0;o>s;s++){var c=n[s];switch(c.$renderMode){case 1:break;case 2:a+=this.drawWithFilter(c,t,0,0);break;case 3:a+=this.drawWithClip(c,t,0,0);break;case 4:a+=this.drawWithScrollRect(c,t,0,0);break;default:a+=this.drawDisplayObject(c,t,0,0)}}return t.context.$drawWebGL(),t.onRenderFinish(),t.context.popBuffer(),a},n.prototype.renderNode=function(e,t,r,i,a){switch(t.$offsetX=r,t.$offsetY=i,e.type){case 1:this.renderBitmap(e,t);break;case 2:this.renderText(e,t);break;case 3:this.renderGraphics(e,t,a);break;case 4:this.renderGroup(e,t);break;case 5:this.renderMesh(e,t);break;case 6:this.renderNormalBitmap(e,t)}},n.prototype.renderNormalBitmap=function(e,t){var r=e.image;r&&t.context.drawImage(r,e.sourceX,e.sourceY,e.sourceW,e.sourceH,e.drawX,e.drawY,e.drawW,e.drawH,e.imageWidth,e.imageHeight,e.rotated,e.smoothing)},n.prototype.renderBitmap=function(t,a){var n=t.image;if(n){var o,s,c,u=t.drawData,h=u.length,d=0,l=t.matrix,f=t.blendMode,p=t.alpha;if(l){o=e.Matrix.create();var g=a.globalMatrix;o.a=g.a,o.b=g.b,o.c=g.c,o.d=g.d,o.tx=g.tx,o.ty=g.ty,s=a.$offsetX,c=a.$offsetY,a.useOffset(),a.transform(l.a,l.b,l.c,l.d,l.tx,l.ty)}f&&a.context.setGlobalCompositeOperation(r[f]);var v;if(p==p&&(v=a.globalAlpha,a.globalAlpha*=p),t.filter){for(a.context.$filter=t.filter;h>d;)a.context.drawImage(n,u[d++],u[d++],u[d++],u[d++],u[d++],u[d++],u[d++],u[d++],t.imageWidth,t.imageHeight,t.rotated,t.smoothing);a.context.$filter=null}else for(;h>d;)a.context.drawImage(n,u[d++],u[d++],u[d++],u[d++],u[d++],u[d++],u[d++],u[d++],t.imageWidth,t.imageHeight,t.rotated,t.smoothing);if(f&&a.context.setGlobalCompositeOperation(i),p==p&&(a.globalAlpha=v),l){var x=a.globalMatrix;x.a=o.a,x.b=o.b,x.c=o.c,x.d=o.d,x.tx=o.tx,x.ty=o.ty,a.$offsetX=s,a.$offsetY=c,e.Matrix.release(o)}}},n.prototype.renderMesh=function(t,a){var n,o,s,c=t.image,u=t.drawData,h=u.length,d=0,l=t.matrix,f=t.blendMode,p=t.alpha;if(l){n=e.Matrix.create();var g=a.globalMatrix;n.a=g.a,n.b=g.b,n.c=g.c,n.d=g.d,n.tx=g.tx,n.ty=g.ty,o=a.$offsetX,s=a.$offsetY,a.useOffset(),a.transform(l.a,l.b,l.c,l.d,l.tx,l.ty)}f&&a.context.setGlobalCompositeOperation(r[f]);var v;if(p==p&&(v=a.globalAlpha,a.globalAlpha*=p),t.filter){for(a.context.$filter=t.filter;h>d;)a.context.drawMesh(c,u[d++],u[d++],u[d++],u[d++],u[d++],u[d++],u[d++],u[d++],t.imageWidth,t.imageHeight,t.uvs,t.vertices,t.indices,t.bounds,t.rotated,t.smoothing);a.context.$filter=null}else for(;h>d;)a.context.drawMesh(c,u[d++],u[d++],u[d++],u[d++],u[d++],u[d++],u[d++],u[d++],t.imageWidth,t.imageHeight,t.uvs,t.vertices,t.indices,t.bounds,t.rotated,t.smoothing);if(f&&a.context.setGlobalCompositeOperation(i),p==p&&(a.globalAlpha=v),l){var x=a.globalMatrix;x.a=n.a,x.b=n.b,x.c=n.c,x.d=n.d,x.tx=n.tx,x.ty=n.ty,a.$offsetX=o,a.$offsetY=s,e.Matrix.release(n)}},n.prototype.renderText=function(r,i){var a=r.width-r.x,n=r.height-r.y;if(!(0>=a||0>=n)&&a&&n&&0!=r.drawData.length){var o=e.sys.DisplayList.$canvasScaleX,s=e.sys.DisplayList.$canvasScaleY,c=i.context.$maxTextureSize;a*o>c&&(o*=c/(a*o)),n*s>c&&(s*=c/(n*s)),a*=o,n*=s;var u=r.x*o,h=r.y*s;(r.$canvasScaleX!=o||r.$canvasScaleY!=s)&&(r.$canvasScaleX=o,r.$canvasScaleY=s,r.dirtyRender=!0);var d=!!t.WebGLRenderContext.getInstance(0,0).context.wxBindCanvasTexture;if(d?(this.canvasRenderer||(this.canvasRenderer=new e.CanvasRenderer),r.dirtyRender&&(this.canvasRenderBuffer=new t.CanvasRenderBuffer(a,n))):this.canvasRenderBuffer&&this.canvasRenderBuffer.context?r.dirtyRender&&this.canvasRenderBuffer.resize(a,n):(this.canvasRenderer=new e.CanvasRenderer,this.canvasRenderBuffer=new t.CanvasRenderBuffer(a,n)),this.canvasRenderBuffer.context){if((1!=o||1!=s)&&this.canvasRenderBuffer.context.setTransform(o,0,0,s,0,0),u||h?(r.dirtyRender&&this.canvasRenderBuffer.context.setTransform(o,0,0,s,-u,-h),i.transform(1,0,0,1,u/o,h/s)):(1!=o||1!=s)&&this.canvasRenderBuffer.context.setTransform(o,0,0,s,0,0),r.dirtyRender){var l=this.canvasRenderBuffer.surface;if(this.canvasRenderer.renderText(r,this.canvasRenderBuffer.context),d)l.isCanvas=!0,r.$texture=l;else{var f=r.$texture;f?i.context.updateTexture(f,l):(f=i.context.createTexture(l),r.$texture=f)}r.$textureWidth=l.width,r.$textureHeight=l.height}var p=r.$textureWidth,g=r.$textureHeight;i.context.drawTexture(r.$texture,0,0,p,g,0,0,p/o,g/s,p,g),(u||h)&&(r.dirtyRender&&this.canvasRenderBuffer.context.setTransform(o,0,0,s,0,0),i.transform(1,0,0,1,-u/o,-h/s)),r.dirtyRender=!1}}},n.prototype.renderGraphics=function(r,i,a){var n=r.width,o=r.height;if(!(0>=n||0>=o)&&n&&o&&0!=r.drawData.length){var s=e.sys.DisplayList.$canvasScaleX,c=e.sys.DisplayList.$canvasScaleY;(1>n*s||1>o*c)&&(s=c=1),(r.$canvasScaleX!=s||r.$canvasScaleY!=c)&&(r.$canvasScaleX=s,r.$canvasScaleY=c,r.dirtyRender=!0),n*=s,o*=c;var u=Math.ceil(n),h=Math.ceil(o);s*=u/n,c*=h/o,n=u,o=h;var d=!!t.WebGLRenderContext.getInstance(0,0).context.wxBindCanvasTexture;if(d?(this.canvasRenderer||(this.canvasRenderer=new e.CanvasRenderer),r.dirtyRender&&(this.canvasRenderBuffer=new t.CanvasRenderBuffer(n,o))):this.canvasRenderBuffer&&this.canvasRenderBuffer.context?r.dirtyRender&&this.canvasRenderBuffer.resize(n,o):(this.canvasRenderer=new e.CanvasRenderer,this.canvasRenderBuffer=new t.CanvasRenderBuffer(n,o)),this.canvasRenderBuffer.context){(1!=s||1!=c)&&this.canvasRenderBuffer.context.setTransform(s,0,0,c,0,0),(r.x||r.y)&&((r.dirtyRender||a)&&this.canvasRenderBuffer.context.translate(-r.x,-r.y),i.transform(1,0,0,1,r.x,r.y));var l=this.canvasRenderBuffer.surface;if(a){this.canvasRenderer.renderGraphics(r,this.canvasRenderBuffer.context,!0);var f=void 0;d?(console.log("forHitTest"),l.isCanvas=!0,f=l):(e.WebGLUtils.deleteWebGLTexture(l),f=i.context.getWebGLTexture(l)),i.context.drawTexture(f,0,0,n,o,0,0,n,o,l.width,l.height)}else{if(r.dirtyRender){if(this.canvasRenderer.renderGraphics(r,this.canvasRenderBuffer.context),d)l.isCanvas=!0,r.$texture=l;else{var f=r.$texture;f?i.context.updateTexture(f,l):(f=i.context.createTexture(l),r.$texture=f)}r.$textureWidth=l.width,r.$textureHeight=l.height}var p=r.$textureWidth,g=r.$textureHeight;i.context.drawTexture(r.$texture,0,0,p,g,0,0,p/s,g/c,p,g)}(r.x||r.y)&&((r.dirtyRender||a)&&this.canvasRenderBuffer.context.translate(r.x,r.y),i.transform(1,0,0,1,-r.x,-r.y)),a||(r.dirtyRender=!1)}}},n.prototype.renderGroup=function(t,r){var i,a,n,o=t.matrix;if(o){i=e.Matrix.create();var s=r.globalMatrix;i.a=s.a,i.b=s.b,i.c=s.c,i.d=s.d,i.tx=s.tx,i.ty=s.ty,a=r.$offsetX,n=r.$offsetY,r.useOffset(),r.transform(o.a,o.b,o.c,o.d,o.tx,o.ty)}for(var c=t.drawData,u=c.length,h=0;u>h;h++){var d=c[h];this.renderNode(d,r,r.$offsetX,r.$offsetY)}if(o){var l=r.globalMatrix;l.a=i.a,l.b=i.b,l.c=i.c,l.d=i.d,l.tx=i.tx,l.ty=i.ty,r.$offsetX=a,r.$offsetY=n,e.Matrix.release(i)}},n.prototype.createRenderBuffer=function(e,r){var i=a.pop();return i?i.resize(e,r):(i=new t.WebGLRenderBuffer(e,r),i.$computeDrawCall=!1),i},n}();t.WebGLRenderer=n,__reflect(n.prototype,"egret.wxgame.WebGLRenderer",["egret.sys.SystemRenderer"])}(t=e.wxgame||(e.wxgame={}))}(egret||(egret={}));var egret;!function(e){var t;!function(e){var t;!function(e){e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.FLOAT=5126]="FLOAT",e[e.BYTE=65535]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT"}(t=e.WEBGL_ATTRIBUTE_TYPE||(e.WEBGL_ATTRIBUTE_TYPE={}));var r=function(){function e(e,t,r){this.gl=e,this.name=r.name,this.type=r.type,this.size=r.size,this.location=e.getAttribLocation(t,this.name),this.count=0,this.initCount(e),this.format=e.FLOAT,this.initFormat(e)}return e.prototype.initCount=function(e){var r=this.type;switch(r){case t.FLOAT:case t.BYTE:case t.UNSIGNED_BYTE:case t.UNSIGNED_SHORT:this.count=1;break;case t.FLOAT_VEC2:this.count=2;break;case t.FLOAT_VEC3:this.count=3;break;case t.FLOAT_VEC4:this.count=4}},e.prototype.initFormat=function(e){var r=this.type;switch(r){case t.FLOAT:case t.FLOAT_VEC2:case t.FLOAT_VEC3:case t.FLOAT_VEC4:this.format=e.FLOAT;break;case t.UNSIGNED_BYTE:this.format=e.UNSIGNED_BYTE;break;case t.UNSIGNED_SHORT:this.format=e.UNSIGNED_SHORT;break;case t.BYTE:this.format=e.BYTE}},e}();e.EgretWebGLAttribute=r,__reflect(r.prototype,"egret.wxgame.EgretWebGLAttribute")}(t=e.wxgame||(e.wxgame={}))}(egret||(egret={}));var egret;!function(e){var t;!function(e){function t(e,t,r){var i=e.createShader(t);e.shaderSource(i,r),e.compileShader(i);var a=e.getShaderParameter(i,e.COMPILE_STATUS);return a||(console.log("shader not compiled!"),console.log(e.getShaderInfoLog(i))),i}function r(e,t,r){var i=e.createProgram();return e.attachShader(i,t),e.attachShader(i,r),e.linkProgram(i),i}function i(t,r){for(var i={},a=t.getProgramParameter(r,t.ACTIVE_ATTRIBUTES),n=0;a>n;n++){var o=t.getActiveAttrib(r,n),s=o.name,c=new e.EgretWebGLAttribute(t,r,o);i[s]=c}return i}function a(t,r){for(var i={},a=t.getProgramParameter(r,t.ACTIVE_UNIFORMS),n=0;a>n;n++){var o=t.getActiveUniform(r,n),s=o.name,c=new e.EgretWebGLUniform(t,r,o);i[s]=c}return i}var n=function(){function e(e,n,o){this.vshaderSource=n,this.fshaderSource=o,this.vertexShader=t(e,e.VERTEX_SHADER,this.vshaderSource),this.fragmentShader=t(e,e.FRAGMENT_SHADER,this.fshaderSource),this.id=r(e,this.vertexShader,this.fragmentShader),this.uniforms=a(e,this.id),this.attributes=i(e,this.id)}return e.getProgram=function(t,r,i,a){return this.programCache[a]||(this.programCache[a]=new e(t,r,i)),this.programCache[a]},e.deleteProgram=function(e,t,r,i){},e.programCache={},e}();e.EgretWebGLProgram=n,__reflect(n.prototype,"egret.wxgame.EgretWebGLProgram")}(t=e.wxgame||(e.wxgame={}))}(egret||(egret={}));var egret;!function(e){var t;!function(e){var t;!function(e){e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.BYTE=65535]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT"}(t=e.WEBGL_UNIFORM_TYPE||(e.WEBGL_UNIFORM_TYPE={}));var r=function(){function e(e,t,r){this.gl=e,this.name=r.name,this.type=r.type,this.size=r.size,this.location=e.getUniformLocation(t,this.name),this.setDefaultValue(),this.generateSetValue(),this.generateUpload()}return e.prototype.setDefaultValue=function(){var e=this.type;switch(e){case t.FLOAT:case t.SAMPLER_2D:case t.SAMPLER_CUBE:case t.BOOL:case t.INT:this.value=0;break;case t.FLOAT_VEC2:case t.BOOL_VEC2:case t.INT_VEC2:this.value=[0,0];break;case t.FLOAT_VEC3:case t.BOOL_VEC3:case t.INT_VEC3:this.value=[0,0,0];break;case t.FLOAT_VEC4:case t.BOOL_VEC4:case t.INT_VEC4:this.value=[0,0,0,0];break;case t.FLOAT_MAT2:this.value=new Float32Array([1,0,0,1]);break;case t.FLOAT_MAT3:this.value=new Float32Array([1,0,0,0,1,0,0,0,1]);break;case t.FLOAT_MAT4:this.value=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}},e.prototype.generateSetValue=function(){var e=this.type;switch(e){case t.FLOAT:case t.SAMPLER_2D:case t.SAMPLER_CUBE:case t.BOOL:case t.INT:this.setValue=function(e){var t=this.value!==e;this.value=e,t&&this.upload()};break;case t.FLOAT_VEC2:case t.BOOL_VEC2:case t.INT_VEC2:this.setValue=function(e){var t=this.value[0]!==e.x||this.value[1]!==e.y;this.value[0]=e.x,this.value[1]=e.y,t&&this.upload()};break;case t.FLOAT_VEC3:case t.BOOL_VEC3:case t.INT_VEC3:this.setValue=function(e){this.value[0]=e.x,this.value[1]=e.y,this.value[2]=e.z,this.upload()};break;case t.FLOAT_VEC4:case t.BOOL_VEC4:case t.INT_VEC4:this.setValue=function(e){this.value[0]=e.x,this.value[1]=e.y,this.value[2]=e.z,this.value[3]=e.w,this.upload()};break;case t.FLOAT_MAT2:case t.FLOAT_MAT3:case t.FLOAT_MAT4:this.setValue=function(e){this.value.set(e),this.upload()}}},e.prototype.generateUpload=function(){var e=this.gl,r=this.type,i=this.location;switch(r){case t.FLOAT:this.upload=function(){var t=this.value;e.uniform1f(i,t)};break;case t.FLOAT_VEC2:this.upload=function(){var t=this.value;e.uniform2f(i,t[0],t[1])};break;case t.FLOAT_VEC3:this.upload=function(){var t=this.value;e.uniform3f(i,t[0],t[1],t[2])};break;case t.FLOAT_VEC4:this.upload=function(){var t=this.value;e.uniform4f(i,t[0],t[1],t[2],t[3])};break;case t.SAMPLER_2D:case t.SAMPLER_CUBE:case t.BOOL:case t.INT:this.upload=function(){var t=this.value;e.uniform1i(i,t)};break;case t.BOOL_VEC2:case t.INT_VEC2:this.upload=function(){var t=this.value;e.uniform2i(i,t[0],t[1])};break;case t.BOOL_VEC3:case t.INT_VEC3:this.upload=function(){var t=this.value;e.uniform3i(i,t[0],t[1],t[2])};break;case t.BOOL_VEC4:case t.INT_VEC4:this.upload=function(){var t=this.value;e.uniform4i(i,t[0],t[1],t[2],t[3])};break;case t.FLOAT_MAT2:this.upload=function(){var t=this.value;e.uniformMatrix2fv(i,!1,t)};break;case t.FLOAT_MAT3:this.upload=function(){var t=this.value;e.uniformMatrix3fv(i,!1,t)};break;case t.FLOAT_MAT4:this.upload=function(){var t=this.value;e.uniformMatrix4fv(i,!1,t)}}},e}();e.EgretWebGLUniform=r,__reflect(r.prototype,"egret.wxgame.EgretWebGLUniform")}(t=e.wxgame||(e.wxgame={}))}(egret||(egret={}));var egret;!function(e){var t;!function(e){var t=function(){function e(){}return e.blur_frag="precision mediump float;\nuniform vec2 blur;\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\nuniform vec2 uTextureSize;\nvoid main()\n{\n    const int sampleRadius = 5;\n    const int samples = sampleRadius * 2 + 1;\n    vec2 blurUv = blur / uTextureSize;\n    vec4 color = vec4(0, 0, 0, 0);\n    vec2 uv = vec2(0.0, 0.0);\n    blurUv /= float(sampleRadius);\n    for (int i = -sampleRadius; i <= sampleRadius; i++) {\n        uv.x = vTextureCoord.x + float(i) * blurUv.x;\n        uv.y = vTextureCoord.y + float(i) * blurUv.y;\n        color += texture2D(uSampler, uv);\n    }\n    color /= float(samples);\n    gl_FragColor = color;\n}",e.colorTransform_frag="precision mediump float;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nuniform mat4 matrix;\nuniform vec4 colorAdd;\nuniform sampler2D uSampler;\nvoid main(void) {\n    vec4 texColor = texture2D(uSampler, vTextureCoord);\n    if(texColor.a > 0.) {\n        texColor = vec4(texColor.rgb / texColor.a, texColor.a);\n    }\n    vec4 locColor = clamp(texColor * matrix + colorAdd, 0., 1.);\n    gl_FragColor = vColor * vec4(locColor.rgb * locColor.a, locColor.a);\n}",e.default_vert="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec2 aColor;\nuniform vec2 projectionVector;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nconst vec2 center = vec2(-1.0, 1.0);\nvoid main(void) {\n   gl_Position = vec4( (aVertexPosition / projectionVector) + center , 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n   vColor = vec4(aColor.x, aColor.x, aColor.x, aColor.x);\n}",e.glow_frag="precision mediump float;\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float dist;\nuniform float angle;\nuniform vec4 color;\nuniform float alpha;\nuniform float blurX;\nuniform float blurY;\nuniform float strength;\nuniform float inner;\nuniform float knockout;\nuniform float hideObject;\nuniform vec2 uTextureSize;\nfloat random(vec3 scale, float seed)\n{\n    return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\n}\nvoid main(void) {\n    vec2 px = vec2(1.0 / uTextureSize.x, 1.0 / uTextureSize.y);\n    const float linearSamplingTimes = 7.0;\n    const float circleSamplingTimes = 12.0;\n    vec4 ownColor = texture2D(uSampler, vTextureCoord);\n    vec4 curColor;\n    float totalAlpha = 0.0;\n    float maxTotalAlpha = 0.0;\n    float curDistanceX = 0.0;\n    float curDistanceY = 0.0;\n    float offsetX = dist * cos(angle) * px.x;\n    float offsetY = dist * sin(angle) * px.y;\n    const float PI = 3.14159265358979323846264;\n    float cosAngle;\n    float sinAngle;\n    float offset = PI * 2.0 / circleSamplingTimes * random(vec3(12.9898, 78.233, 151.7182), 0.0);\n    float stepX = blurX * px.x / linearSamplingTimes;\n    float stepY = blurY * px.y / linearSamplingTimes;\n    for (float a = 0.0; a <= PI * 2.0; a += PI * 2.0 / circleSamplingTimes) {\n        cosAngle = cos(a + offset);\n        sinAngle = sin(a + offset);\n        for (float i = 1.0; i <= linearSamplingTimes; i++) {\n            curDistanceX = i * stepX * cosAngle;\n            curDistanceY = i * stepY * sinAngle;\n            \n            curColor = texture2D(uSampler, vec2(vTextureCoord.x + curDistanceX - offsetX, vTextureCoord.y + curDistanceY + offsetY));\n            totalAlpha += (linearSamplingTimes - i) * curColor.a;\n            maxTotalAlpha += (linearSamplingTimes - i);\n        }\n    }\n    ownColor.a = max(ownColor.a, 0.0001);\n    ownColor.rgb = ownColor.rgb / ownColor.a;\n    float outerGlowAlpha = (totalAlpha / maxTotalAlpha) * strength * alpha * (1. - inner) * max(min(hideObject, knockout), 1. - ownColor.a);\n    float innerGlowAlpha = ((maxTotalAlpha - totalAlpha) / maxTotalAlpha) * strength * alpha * inner * ownColor.a;\n    ownColor.a = max(ownColor.a * knockout * (1. - hideObject), 0.0001);\n    vec3 mix1 = mix(ownColor.rgb, color.rgb, innerGlowAlpha / (innerGlowAlpha + ownColor.a));\n    vec3 mix2 = mix(mix1, color.rgb, outerGlowAlpha / (innerGlowAlpha + ownColor.a + outerGlowAlpha));\n    float resultAlpha = min(ownColor.a + outerGlowAlpha + innerGlowAlpha, 1.);\n    gl_FragColor = vec4(mix2 * resultAlpha, resultAlpha);\n}",e.primitive_frag="precision lowp float;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvoid main(void) {\n    gl_FragColor = vColor;\n}",e.texture_frag="precision lowp float;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nuniform sampler2D uSampler;\nvoid main(void) {\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;\n}",e
}();e.EgretShaderLib=t,__reflect(t.prototype,"egret.wxgame.EgretShaderLib")}(t=e.wxgame||(e.wxgame={}))}(egret||(egret={}));